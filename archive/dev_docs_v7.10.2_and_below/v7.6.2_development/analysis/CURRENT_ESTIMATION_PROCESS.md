# í˜„ì¬ Estimator ì¶”ì • í”„ë¡œì„¸ìŠ¤ (v7.5.0)

## ğŸ“Š í˜„ì¬ êµ¬ì¡°

```
EstimatorRAG.estimate(question, context)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tier 1: Fast Path (<0.5ì´ˆ)                â”‚
â”‚  â”œâ”€ Built-in Rules (YAML)                  â”‚
â”‚  â””â”€ RAG Search (learned_rules, 0.95+)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ ì‹¤íŒ¨
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tier 2: Judgment Path (3-8ì´ˆ)             â”‚
â”‚                                             â”‚
â”‚  SourceCollector.collect_all()             â”‚
â”‚  â”œâ”€ Physical Constraints (3ê°œ)             â”‚
â”‚  â”‚   â”œâ”€ Spacetime                          â”‚
â”‚  â”‚   â”œâ”€ Conservation                       â”‚
â”‚  â”‚   â””â”€ Mathematical                       â”‚
â”‚  â”‚                                          â”‚
â”‚  â”œâ”€ Value Sources (5ê°œ)                    â”‚
â”‚  â”‚   â”œâ”€ Definite Data                      â”‚
â”‚  â”‚   â”œâ”€ LLM Estimation                     â”‚
â”‚  â”‚   â”œâ”€ Web Search (ë¯¸êµ¬í˜„)                â”‚
â”‚  â”‚   â”œâ”€ RAG Benchmark                      â”‚
â”‚  â”‚   â””â”€ Statistical Value                  â”‚
â”‚  â”‚                                          â”‚
â”‚  â””â”€ Soft Constraints (3ê°œ)                 â”‚
â”‚      â”œâ”€ Legal                               â”‚
â”‚      â”œâ”€ Statistical Pattern                â”‚
â”‚      â””â”€ Behavioral                          â”‚
â”‚                                             â”‚
â”‚  Judgment.synthesize()                     â”‚
â”‚  â””â”€ 11ê°œ ì¦ê±° ì¢…í•© íŒë‹¨ (0.80+ í•„ìš”)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ ì‹¤íŒ¨
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tier 3: Fermi Decomposition (10-30ì´ˆ)     â”‚
â”‚                                             â”‚
â”‚  â”œâ”€ Phase 1: ì´ˆê¸° ìŠ¤ìº” (ê°€ìš© ë°ì´í„°)       â”‚
â”‚  â”œâ”€ Phase 2: ëª¨í˜• ìƒì„±                     â”‚
â”‚  â”‚   â”œâ”€ Native Mode (ì§ì ‘ ìƒì„±)            â”‚
â”‚  â”‚   â””â”€ External Mode (LLM API)            â”‚
â”‚  â”œâ”€ Phase 3: ì‹¤í–‰ ê°€ëŠ¥ì„± ì²´í¬ (ì¬ê·€)       â”‚
â”‚  â””â”€ Phase 4: ëª¨í˜• ì‹¤í–‰                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ ì‹¤íŒ¨
    â†“
  None ë°˜í™˜
```

---

## âŒ í˜„ì¬ ë¬¸ì œì 

### **Validator ê²€ìƒ‰ì´ í”„ë¡œì„¸ìŠ¤ì— ì—†ìŒ!**

```
Tier 1 (í•™ìŠµ ê·œì¹™)
    â†“ ì‹¤íŒ¨
    
âŒ Validator ê²€ìƒ‰ ëˆ„ë½!  â† ì—¬ê¸°ì„œ ë¨¼ì € í™•ì • ë°ì´í„° ì°¾ì•„ì•¼ í•¨!
    
    â†“
Tier 2 (ì¶”ì • ì‹œì‘)
```

í˜„ì¬ëŠ” **Tier 1 ì‹¤íŒ¨ â†’ ë°”ë¡œ Tier 2 ì¶”ì • ì‹œì‘**
ì˜¬ë°”ë¥¸ ìˆœì„œëŠ” **Tier 1 ì‹¤íŒ¨ â†’ Validator ê²€ìƒ‰ â†’ ì—†ìœ¼ë©´ Tier 2 ì¶”ì •**

---

## âœ… ì˜¬ë°”ë¥¸ í”„ë¡œì„¸ìŠ¤ (ì œì•ˆ)

```
EstimatorRAG.estimate(question, context)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Tier 1 (Fast Path)                â”‚
â”‚  â”œâ”€ Built-in Rules                         â”‚
â”‚  â””â”€ Learned Rules (RAG 0.95+)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ ì—†ìŒ
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â­ Step 2: Validator ê²€ìƒ‰ (NEW!)           â”‚
â”‚                                             â”‚
â”‚  ValidatorRAG.search_definite_data()       â”‚
â”‚  â”œâ”€ í™•ì • ë°ì´í„° ê²€ìƒ‰                        â”‚
â”‚  â”œâ”€ ë²¤ì¹˜ë§ˆí¬ ì¡°íšŒ                           â”‚
â”‚  â””â”€ ê³µì‹ í†µê³„                               â”‚
â”‚                                             â”‚
â”‚  ë°œê²¬ ì‹œ:                                   â”‚
â”‚  â””â”€ ì¦‰ì‹œ ë°˜í™˜ (confidence 1.0)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ ì—†ìŒ
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Tier 2 (ì¶”ì • ì‹œì‘)                 â”‚
â”‚  â”œâ”€ 11ê°œ Source ìˆ˜ì§‘                       â”‚
â”‚  â””â”€ ì¢…í•© íŒë‹¨ (confidence 0.80+)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ ì‹¤íŒ¨ (confidence < 0.80)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Tier 3 (Fermi ë¶„í•´)               â”‚
â”‚  â”œâ”€ Native/External Mode                   â”‚
â”‚  â””â”€ ì¬ê·€ ì¶”ì •                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ ì‹¤íŒ¨
    â†“
  None ë°˜í™˜
```

---

## ğŸ” ì„¸ë¶€ ë¹„êµ

### í˜„ì¬ (v7.5.0)
```python
def estimate(question, context):
    # Tier 1: í•™ìŠµ ê·œì¹™
    result = tier1.estimate(question, context)
    if result:
        return result
    
    # Tier 2: ì¶”ì • ì‹œì‘ (ë°”ë¡œ!)
    result = tier2.estimate(question, context)
    if result:
        return result
    
    # Tier 3: Fermi
    result = tier3.estimate(question, context)
    return result
```

### ê°œì„ ì•ˆ
```python
def estimate(question, context):
    # Tier 1: í•™ìŠµ ê·œì¹™
    result = tier1.estimate(question, context)
    if result:
        return result
    
    # â­ NEW: Validator ê²€ìƒ‰ (í™•ì • ë°ì´í„°)
    result = validator.search_definite_data(question, context)
    if result:
        return result  # confidence 1.0
    
    # Tier 2: ì¶”ì • ì‹œì‘ (Validatorë„ ì—†ì„ ë•Œë§Œ!)
    result = tier2.estimate(question, context)
    if result:
        return result
    
    # Tier 3: Fermi
    result = tier3.estimate(question, context)
    return result
```

---

## ğŸ“Œ í•µì‹¬ ì°¨ì´

| í•­ëª© | í˜„ì¬ | ê°œì„ ì•ˆ |
|------|------|--------|
| Tier 1 ì‹¤íŒ¨ í›„ | Tier 2 (ì¶”ì •) | **Validator (ê²€ìƒ‰)** |
| í™•ì • ë°ì´í„° ìš°ì„ ìˆœìœ„ | ë‚®ìŒ (Tier 2 ì•ˆì—) | **ìµœìš°ì„ ** |
| ë¶ˆí•„ìš”í•œ ì¶”ì • | ìˆìŒ | **ê°ì†Œ** |
| ì‹ ë¢°ë„ | ë‚®ì„ ìˆ˜ ìˆìŒ | **í–¥ìƒ** |

---

## ğŸ¯ Validatorì˜ ì—­í• 

### **í™•ì • ë°ì´í„° ê²€ìƒ‰**
```python
ValidatorRAG.search_definite_data(question, context):
    1. data_sources_registry ê²€ìƒ‰
       - ê³µì‹ í†µê³„ (í†µê³„ì²­, ì§ˆë³‘ê´€ë¦¬ì²­ ë“±)
       - ì •ë¶€ ë°ì´í„°
       - ì—…ê³„ í‘œì¤€
    
    2. ë²¤ì¹˜ë§ˆí¬ ë°ì´í„° ê²€ìƒ‰
       - ì‚°ì—…ë³„ í‰ê· 
       - ê¸€ë¡œë²Œ í‘œì¤€
    
    3. ì •ì˜ ê²€ì¦
       - ìš©ì–´ ì •ì˜ í™•ì¸
       - ì¸¡ì • ë°©ë²• í™•ì¸
    
    ë°œê²¬ ì‹œ:
    â””â”€ EstimationResult(value, confidence=1.0, tier=1.5)
```

### **Tier 2ì™€ì˜ ì°¨ì´**
- **Validator**: í™•ì • ë°ì´í„° ê²€ìƒ‰ (ì¶”ì • ì•ˆí•¨!)
- **Tier 2**: ì¦ê±° ìˆ˜ì§‘ â†’ **ì¶”ì •/íŒë‹¨**

---

## ğŸ”§ êµ¬í˜„ í•„ìš” ì‚¬í•­

### 1. **Validator ë©”ì„œë“œ ì¶”ê°€**
```python
# umis_rag/agents/validator.py

def search_definite_data(
    self,
    question: str,
    context: Context
) -> Optional[EstimationResult]:
    """
    í™•ì • ë°ì´í„° ê²€ìƒ‰ (ì¶”ì • ì•ˆí•¨!)
    
    Returns:
        EstimationResult(confidence=1.0) ë˜ëŠ” None
    """
    # 1. data_sources_registry ê²€ìƒ‰
    # 2. ì •ì˜ í™•ì¸
    # 3. ê°’ ì¶”ì¶œ (ìˆìœ¼ë©´)
    # 4. EstimationResult ë°˜í™˜
```

### 2. **Estimator.estimate() ìˆ˜ì •**
```python
# umis_rag/agents/estimator/estimator.py

def estimate(question, context):
    # Tier 1
    result = self.tier1.estimate(question, context)
    if result:
        return result
    
    # â­ NEW: Validator ê²€ìƒ‰
    if self.validator is None:
        from umis_rag.agents.validator import get_validator_rag
        self.validator = get_validator_rag()
    
    result = self.validator.search_definite_data(question, context)
    if result:
        logger.info(f"  âœ… Validator: í™•ì • ë°ì´í„° ë°œê²¬")
        return result
    
    # Tier 2
    result = self.tier2.estimate(question, context)
    # ...
```

---

## ğŸ“Š ì˜ˆìƒ íš¨ê³¼

### **Before**
```
"í•œêµ­ ì¸êµ¬ëŠ”?" ì§ˆë¬¸
  â†“
Tier 1: í•™ìŠµ ê·œì¹™ ì—†ìŒ â†’ ì‹¤íŒ¨
  â†“
Tier 2: 11ê°œ Source ìˆ˜ì§‘ (3-8ì´ˆ)
  â†’ ì¶”ì • ì‹œì‘ (ë¶ˆí•„ìš”!)
  â†’ confidence 0.70 (ë‚®ìŒ)
```

### **After**
```
"í•œêµ­ ì¸êµ¬ëŠ”?" ì§ˆë¬¸
  â†“
Tier 1: í•™ìŠµ ê·œì¹™ ì—†ìŒ â†’ ì‹¤íŒ¨
  â†“
â­ Validator: data_sources_registry ê²€ìƒ‰
  â†’ "í†µê³„ì²­: 51,000,000ëª…" ë°œê²¬!
  â†’ **ì¦‰ì‹œ ë°˜í™˜ (confidence 1.0)** âœ…
  
Tier 2 ì‹¤í–‰ ì•ˆí•¨ â†’ ì‹œê°„/ë¹„ìš© ì ˆê°!
```

---

## âœ… ê²°ë¡ 

**í˜„ì¬ í”„ë¡œì„¸ìŠ¤ì˜ í•µì‹¬ ë¬¸ì œ:**
- Validator ê²€ìƒ‰ì´ ëˆ„ë½ë¨
- Tier 1 ì‹¤íŒ¨ â†’ ë°”ë¡œ ì¶”ì • ì‹œì‘ (ë¹„íš¨ìœ¨)

**ê°œì„  ë°©í–¥:**
1. Tier 1.5ì— Validator ê²€ìƒ‰ ì¶”ê°€
2. í™•ì • ë°ì´í„° ìš°ì„  ê²€ìƒ‰
3. ì—†ì„ ë•Œë§Œ Tier 2 ì¶”ì • ì‹œì‘

**ê¸°ëŒ€ íš¨ê³¼:**
- ì‹ ë¢°ë„ í–¥ìƒ (1.0)
- ì‹¤í–‰ ì‹œê°„ ë‹¨ì¶•
- ë¶ˆí•„ìš”í•œ ì¶”ì • ê°ì†Œ

