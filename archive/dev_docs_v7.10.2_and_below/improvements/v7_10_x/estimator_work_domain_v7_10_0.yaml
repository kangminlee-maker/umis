# Estimator Work Domain (v7.10.0 Hybrid Architecture)
# ì´ ë‚´ìš©ì„ umis.yamlì˜ Estimator ì„¹ì…˜ "# ===== 3. WORK DOMAIN =====" ë¶€ë¶„ì— ë°˜ì˜

    # ===== 3. WORK DOMAIN (Hybrid Architecture v7.10.0 - Proposal) =====
    hybrid_architecture_v7_10_0:
      version: "v7.10.0"
      status: "ğŸš§ ì„¤ê³„ ì™„ë£Œ, êµ¬í˜„ ëŒ€ê¸° (Week 1-5)"
      
      paradigm_shift:
        from: "Sequential Fallback (Phase 0â†’1â†’2â†’3â†’4, Early Return)"
        to: "Hybrid (Fast Cascade + Parallel Estimation + Synthesis)"
        key_changes:
          - "Phase 0-2: ì •ë³´ ì†ì‹¤ ì œê±° (ìœ ì‚¬ ë°ì´í„° â†’ ê°€ë“œë ˆì¼ ë³€í™˜)"
          - "Phase 3-4: ë³‘ë ¬ ì‹¤í–‰ (ë…ë¦½ì  ì¶”ì • â†’ êµì°¨ ê²€ì¦)"
          - "Synthesis: ëª¨ë“  Phase í†µí•© (ê°€ì¤‘ ì¢…í•© + ì‹ ë¢°ë„ í–¥ìƒ)"

      design_goals:
        - "í™•ì •ê°’ Fast Path ìœ ì§€ (0.001s)"
        - "ìœ ì‚¬ ë°ì´í„° 100% í™œìš© (ê°€ë“œë ˆì¼ë¡œ ë³€í™˜)"
        - "êµì°¨ ê²€ì¦ (Range âˆ‹ Point â†’ +15%)"
        - "ì‹ ë¢°ë„ í–¥ìƒ (+15-20% ëª©í‘œ)"
        - "100% ì»¤ë²„ë¦¬ì§€ ìœ ì§€"

      # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      # Stage Overview (3-Stage Pipeline)
      # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      stage_overview:
        
        stage_1_tiered_collection:
          name: "Stage 1 - ê²€ì¦ & ê°€ë“œë ˆì¼ ìˆ˜ì§‘ (Tiered Collection)"
          description: "Phase 0-2ë¥¼ ìˆœì°¨ ì‹¤í–‰í•˜ë©´ì„œ í™•ì •ê°’ê³¼ ê°€ë“œë ˆì¼ì„ ëª¨ìœ¼ëŠ” ë‹¨ê³„"
          phases: [0, 1, 2]
          speed: "0.001~1ì´ˆ"
          fast_path: "100% ë™ì¼ ë°ì´í„° ë°œê²¬ ì‹œ ì¦‰ì‹œ ë°˜í™˜ âš¡"
          
          outputs:
            definite_values:
              description: "ì´ë¯¸ ê³„ì‚°/ê²€ì¦/í•™ìŠµëœ ì •í™•í•œ ê°’ ë¦¬ìŠ¤íŠ¸"
              confidence: "1.0 (í™•ì •)"
              sources:
                - "í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸ (Phase 0)"
                - "í•™ìŠµëœ ê·œì¹™ (Phase 1)"
                - "Validator ê²€ì¦ê°’ (Phase 2)"
              
            guardrails:
              description: "ìƒí•œ/í•˜í•œ/ì§‘í•© í¬í•¨ê´€ê³„/ë¹„ìœ¨ ë“± ì œì•½ ì¡°ê±´ ì„¸íŠ¸"
              types:
                hard:
                  - "hard_upper: ë…¼ë¦¬ì  ìƒí•œ (ìŒì‹ì  < ì‚¬ì—…ì)"
                  - "hard_lower: ë…¼ë¦¬ì  í•˜í•œ (ìì˜ì—…ì > 0)"
                  - "logical: ë¬¼ë¦¬ì /ìˆ˜í•™ì  ì œì•½ (value >= 0)"
                soft:
                  - "soft_upper: ê²½í—˜ì  ìƒí•œ (í†µê³„ì  ë²”ìœ„)"
                  - "soft_lower: ê²½í—˜ì  í•˜í•œ"
                  - "expected_range: ì¼ë°˜ì  ë²”ìœ„"
              usage: "Phase 3-4ì— ì „ë‹¬í•˜ì—¬ ì¶”ì • ë²”ìœ„ ì¢íˆê¸°"

        stage_2_parallel_estimation:
          name: "Stage 2 - ë³‘ë ¬ ì¶”ì • (Parallel Estimation)"
          description: "Phase 3 (Range)ì™€ Phase 4 (Point)ë¥¼ ë³‘ë ¬ ì‹¤í–‰í•˜ì—¬ ìƒí˜¸ ë³´ì™„ì  ì¶”ì • ìƒì„±"
          phases: [3, 4]
          speed: "max(3~8ì´ˆ, 10~30ì´ˆ) = ë³‘ë ¬ ì‹¤í–‰ìœ¼ë¡œ ìµœëŒ€ ì‹œê°„ë§Œ ì†Œìš”"
          parallelism: "asyncio.gather(phase3, phase4)"
          
          inputs:
            - "question: ì¶”ì • ëŒ€ìƒ ì§ˆë¬¸"
            - "context: domain/region/time ë§¥ë½"
            - "guardrails: Stage 1ì—ì„œ ìˆ˜ì§‘ëœ ì œì•½ ì¡°ê±´"
          
          outputs:
            phase3_range_estimate:
              description: "Hard Guardrail ê¸°ë°˜ ì•ˆì „í•œ ë²”ìœ„ ì¶”ì •"
              type: "Range Estimation (Top-Down)"
              output_format:
                value: "None (ë¶€ìˆ˜ì ) ë˜ëŠ” Range ì¤‘ì•™ê°’"
                value_range: "[min, max] (í•„ìˆ˜)"
                confidence: "0.90-0.95 (Hard ì œì•½ ê¸°ë°˜)"
                reasoning: "11ê°œ Source + Hard Guardrails"
              
            phase4_point_estimate:
              description: "Fermi ë¶„í•´ ê¸°ë°˜ ë‹¨ì¼ ê°’ ì¶”ì •"
              type: "Point Estimation (Bottom-Up)"
              output_format:
                value: "ë‹¨ì¼ ê°’ (í•„ìˆ˜)"
                value_range: "None (ë˜ëŠ” Â±ë¶ˆí™•ì‹¤ì„±)"
                confidence: "0.60-0.80 (ë¶„í•´ ë³µì¡ë„ ë°˜ì˜)"
                reasoning: "Decomposition Trace"

        stage_3_synthesis:
          name: "Stage 3 - Synthesis (ì¢…í•© íŒë‹¨)"
          description: "ëª¨ë“  Phase ê²°ê³¼ì™€ guardrailsë¥¼ í†µí•©í•˜ì—¬ ìµœì¢… EstimationResult ìƒì„±"
          speed: "0.1ì´ˆ"
          phase_number:
            external_api: "4 (API í˜¸í™˜ì„± ìœ ì§€)"
            internal_log: "5 ë˜ëŠ” 'Synthesis' (ë¡œê·¸ ëª…í™•í™”)"
          
          responsibilities:
            
            step_1_definite_values_priority:
              description: "definite_values ìš°ì„  ë°˜í™˜"
              condition: "Stage 1ì—ì„œ confidence=1.0 í™•ì •ê°’ ë°œê²¬"
              action: "ê·¸ëŒ€ë¡œ ë°˜í™˜ (Fast Path)"
              result:
                confidence: "1.0"
                phase: "ì›ë³¸ phase (0/1/2)"
                reasoning: "í™•ì • ë°ì´í„° ì§ì ‘ ë°˜í™˜"
            
            step_2_cross_validation:
              description: "Phase 3 Range âˆ‹ Phase 4 Point ì—¬ë¶€ ê²€ì¦"
              
              case_success:
                condition: "phase4_value âˆˆ [phase3_range_min, phase3_range_max]"
                confidence_boost: "+15% (ìµœëŒ€ 1.0)"
                range_narrowing:
                  method: "Intersection(Phase3_Range, PointÂ±10%)"
                  example: "[20ë§Œ, 40ë§Œ] âˆ© [27ë§Œ, 33ë§Œ] = [27ë§Œ, 33ë§Œ]"
                reasoning: "ë‘ ë…ë¦½ ì¶”ì • ì¼ì¹˜ â†’ ì‹ ë¢°ë„ í–¥ìƒ"
              
              case_failure:
                condition: "phase4_value âˆ‰ phase3_range"
                confidence_penalty: "-10%"
                range_expansion:
                  method: "Union(Phase3_Range, PointÂ±20%)"
                  example: "[20ë§Œ, 40ë§Œ] âˆª [48ë§Œ, 72ë§Œ] = [20ë§Œ, 72ë§Œ]"
                reasoning: "ë¶ˆì¼ì¹˜ â†’ ë¶ˆí™•ì‹¤ì„± ì¦ê°€, ì¬ê²€í†  í•„ìš”"
            
            step_3_weighted_fusion:
              description: "ì‹ ë¢°ë„/ë¶ˆí™•ì‹¤ì„± ê¸°ë°˜ ê°€ì¤‘ í‰ê· ìœ¼ë¡œ ìµœì¢… ê°’ ì‚°ì¶œ"
              
              patterns:
                confidence_weighted:
                  formula: "value = Î£(conf_i Ã— value_i) / Î£(conf_i)"
                  usage: "Phase 3/4 ì‹ ë¢°ë„ ê¸°ë°˜ ê°€ì¤‘ í‰ê· "
                
                uncertainty_weighted:
                  formula: "weight_i = 1 / uncertainty_iÂ²"
                  pattern: "Kalman Filter (ì„¼ì„œ í“¨ì „)"
                  usage: "ë¶ˆí™•ì‹¤ì„± ëª…ì‹œì  ì¶”ì  ì‹œ"
                
                meta_learning:
                  condition: "ê³¼ê±° 10ê°œ ì´ìƒ ì´ë ¥ ì¡´ì¬"
                  method: "Ridge Regressionìœ¼ë¡œ ê°€ì¤‘ì¹˜ í•™ìŠµ"
                  usage: "Phaseë³„ ê³¼ê±° ì •í™•ë„ ë°˜ì˜"
            
            step_4_guardrail_validation:
              description: "ìµœì¢… ê°’ì´ ê°€ë“œë ˆì¼ ìœ„ë°˜ ì—¬ë¶€ ê²€ì¦ ë° ì¡°ì •"
              
              hard_violation:
                action: "ê°’ì„ ê²½ê³„ê°’ìœ¼ë¡œ í´ë¨í•‘ (ê°•ì œ ì¡°ì •)"
                confidence_penalty: "Ã— 0.7 (-30%)"
                logging: "reasoning_detail.guardrail_violationsì— ê¸°ë¡"
                example: "ì¶”ì •ê°’ 50ë§Œ > ìƒí•œ 40ë§Œ â†’ 40ë§Œìœ¼ë¡œ ì¡°ì •"
              
              soft_violation:
                action: "ê²½ê³ ë§Œ ê¸°ë¡, ê°’ì€ ìœ ì§€"
                confidence_penalty: "Ã— 0.9 (-10%)"
                logging: "reasoning_detailì— ê²½ê³ ë§Œ"
                example: "ì¶”ì •ê°’ 45ë§Œ, ì˜ˆìƒ ë²”ìœ„ [20ë§Œ, 40ë§Œ] â†’ ìœ ì§€í•˜ë˜ ê²½ê³ "
            
            step_5_result_construction:
              description: "ìµœì¢… EstimationResult ê°ì²´ ìƒì„±"
              fields:
                value: "ìµœì¢… ê°’ (ê°€ì¤‘ í‰ê·  + ê°€ë“œë ˆì¼ ì¡°ì •)"
                value_range: "ìµœì¢… ë²”ìœ„ (Narrowing/Expansion)"
                confidence: "ìµœì¢… ì‹ ë¢°ë„ (Boost/Penalty ë°˜ì˜)"
                uncertainty: "ë¶ˆí™•ì‹¤ì„± (Propagation)"
                phase: "4 (API) or 5 (ë‚´ë¶€)"
                sources_used: "ê° Phase ì¶œì²˜ ë¦¬ìŠ¤íŠ¸"
                reasoning_detail: "êµì°¨ ê²€ì¦ + ê°€ì¤‘ í†µí•© + ê°€ë“œë ˆì¼ ê³¼ì • ì „ì²´ ë¡œê·¸"

      # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      # Information Flow
      # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      information_flow:
        pattern: "Unidirectional Cascade + Shared GuardrailCollector"
        
        shared_state:
          collector:
            name: "GuardrailCollector"
            stores:
              - "definite_values: List[EstimationResult]"
              - "hard_guardrails: List[Guardrail]"
              - "soft_guardrails: List[Guardrail]"
          
          visibility:
            phase_0_2: "Write-only (ìˆ˜ì§‘ë§Œ)"
            phase_3_4: "Read/Write (ì½ê¸° + ì¶”ê°€ ê°€ë“œë ˆì¼ ìƒì„±)"
            synthesis: "Read-only (ìµœì¢… íŒë‹¨)"
        
        early_return_policy:
          fast_path:
            condition: "Phase 0-2ì—ì„œ confidence=1.0 í™•ì •ê°’ ë°œê²¬"
            action: "ì¦‰ì‹œ ë°˜í™˜ (Stage 2-3 ìŠ¤í‚µ)"
            speed: "0.001~1ì´ˆ âš¡âš¡âš¡"
          
          no_early_return:
            principle: "í™•ì •ê°’ ì—†ìœ¼ë©´ ëª¨ë“  Phase ê²°ê³¼ë¥¼ Synthesisë¡œ ì „ë‹¬"
            rationale: "ì •ë³´ ì†ì‹¤ ë°©ì§€, êµì°¨ ê²€ì¦ ê°€ëŠ¥"

      # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      # Phase Definitions (Detailed)
      # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      phase_definitions:
        
        phase_0_project_data:
          name: "Phase 0 - Literal (Project Data)"
          role: "í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸ ë‚´ ëª…ì‹œ ê°’ í™•ì¸"
          speed: "<0.001ì´ˆ"
          
          typical_sources:
            - "Owner ì§ì ‘ ì…ë ¥ ìˆ«ì"
            - "ì´ì „ Workflow Export ê°’"
            - "í”„ë¡œì íŠ¸ ì„¤ì • íŒŒì¼ ì´ˆê¸° ê°’"
          
          behavior:
            exact_match:
              description: "ì§ˆë¬¸ê³¼ ì •ì˜/ë§¥ë½ 100% ì¼ì¹˜"
              action:
                - "definite_valuesì— ì¶”ê°€ (confidence=1.0)"
                - "Fast Path ì¡°ê±´ ë§Œì¡± ì‹œ ì¦‰ì‹œ ë°˜í™˜"
            
            similar_match:
              description: "ì •ì˜ ë™ì¼, ë§¥ë½ ì•½ê°„ ë‹¤ë¦„ (ì—°ë„/ì§€ì—­ ë“±)"
              action:
                - "soft_guardrailsì— ì¶”ê°€ (ì°¸ê³ ìš©)"
                - "ì˜ˆ: 2023ë…„ ê°’ â†’ 2024ë…„ ì¶”ì • ì‹œ ì„±ì¥ë¥  ê°€ì • ê¸°ì¤€"

        phase_1_direct_rag:
          name: "Phase 1 - Direct RAG (Learned Rules)"
          role: "ê³¼ê±° Estimator ê²°ê³¼/í•™ìŠµ ê·œì¹™ì—ì„œ ê°’ê³¼ ì œì•½ ê²€ìƒ‰"
          speed: "<0.5ì´ˆ"
          coverage: "5% (ì´ˆê¸°) â†’ 40% (Year 1)"
          
          behavior:
            exact_match:
              description: "ë™ì¼ ì§ˆë¬¸Â·ì •ì˜Â·ë§¥ë½ì— ê³¼ê±° EstimationResult ì¡´ì¬"
              action:
                - "definite_valuesì— ì¶”ê°€ (source='Phase1', conf â‰¥ 0.90)"
                - "ì›ë³¸ phase ìœ ì§€, í˜„ì¬ ìš”ì²­ phase=1ë¡œ tagging"
            
            similar_match:
              description: "êµ¬ì¡°/ì •ì˜ ë™ì¼, ì§ˆë¬¸ ë‹¤ë¦„"
              example: "'B2B SaaS ARPU' vs 'í•œêµ­ B2B SaaS ARPU'"
              action:
                - "guardrailsì— bound_constraint ì¶”ê°€"
                - "ìƒí•œ/í•˜í•œ/ë¹„ìœ¨/order_of_magnitude"
                - "Phase 3ì—ì„œ hard constraint í›„ë³´ë¡œ ì‚¬ìš©"
          
          outputs:
            to_collector:
              - "definite_values (exact match)"
              - "hard/soft_guardrails (similar match)"

        phase_2_validator_rag:
          name: "Phase 2 - Validator (í™•ì • ë°ì´í„°)"
          role: "Validator ê²€ì¦ ì™¸ë¶€ ë°ì´í„°ì—ì„œ í™•ì •ê°’ê³¼ êµ¬ì¡°ì  ì œì•½ ê²€ìƒ‰"
          speed: "<1ì´ˆ"
          
          behavior:
            confirmed_value:
              description: "Validatorê°€ confidence=1.0ìœ¼ë¡œ ê²€ì¦í•œ ìˆ«ì"
              action:
                - "definite_valuesì— ì¶”ê°€ (source='Validator', conf=1.0)"
                - "ë™ì‹œì— hard_guardrailë¡œë„ ë“±ë¡ (ìµœìƒìœ„ ìš°ì„ ìˆœìœ„)"
            
            related_metric:
              description: "êµ¬ì¡°ì ìœ¼ë¡œ ì—°ê²°ëœ ì§€í‘œ"
              examples:
                - "'ê°œì¸ì‚¬ì—…ì ìˆ˜' ì§ˆë¬¸ ì‹œ â†’ 'ì‚¬ì—…ì ìˆ˜', 'ê²½ì œí™œë™ì¸êµ¬ ìˆ˜'"
                - "'ìì˜ì—…ì ìˆ˜' ì§ˆë¬¸ ì‹œ â†’ 'ê°œì¸ì‚¬ì—…ì ìˆ˜', 'ê²½ì œí™œë™ì¸êµ¬ ìˆ˜'"
              action:
                - "structural_constraintë¡œ guardrailsì— ì¶”ê°€"
                - "ì˜ˆ: 'ê°œì¸ì‚¬ì—…ì â‰¤ ì‚¬ì—…ì â‰¤ ê²½ì œí™œë™ì¸êµ¬'"
          
          outputs:
            to_collector:
              - "definite_values (confirmed_value)"
              - "hard_guardrails (structural_constraint)"

        phase_3_guardrail_range_engine:
          name: "Phase 3 - Guardrail Range Engine (Hard Constraints)"
          role: "Hard Guardrail ê¸°ë°˜ìœ¼ë¡œ ê°’ì´ ì¡´ì¬í•´ì•¼ í•˜ëŠ” ì•ˆì „í•œ ë²”ìœ„ ê³„ì‚°"
          redesign_v7_10_0: "ìˆœìˆ˜ Range ì—”ì§„ìœ¼ë¡œ ì¬ì •ì˜ (valueëŠ” ë¶€ìˆ˜ì )"
          speed: "3-8ì´ˆ"
          
          output:
            value: "None (ë˜ëŠ” Range ì¤‘ì•™ê°’, ë¶€ìˆ˜ì )"
            value_range: "[min, max] (í•µì‹¬ ì¶œë ¥)"
            confidence: "0.90-0.95 (Hard Guardrail ê¸°ë°˜)"
            uncertainty: "Range í­ ê¸°ë°˜"
          
          constraints_usage:
            hard_only:
              description: "ë…¼ë¦¬ì ìœ¼ë¡œ 100% ìœ„ë°˜ ë¶ˆê°€í•œ ì œì•½ë§Œ ì‚¬ìš©"
              examples:
                - "ìì˜ì—…ì ìˆ˜ â‰¤ ê²½ì œí™œë™ì¸êµ¬ ìˆ˜"
                - "ê°œì¸ì‚¬ì—…ì â‰¤ ì‚¬ì—…ì â‰¤ ê²½ì œí™œë™ì¸êµ¬"
                - "value >= 0 (ë¬¼ë¦¬ì )"
              action: "Range ìì²´ë¥¼ ì œí•œ"
            
            soft_context_only:
              description: "ê²½í—˜ì /í†µê³„ì  ì œì•½"
              examples:
                - "ì‹ ê³  ëˆ„ë½ ìì˜ì—…ì ì¡´ì¬ â†’ ì‹¤ì œ > ì‹ ê³ "
                - "ìì˜ì—… ë¹„ìœ¨ ~ 20% (ê²½í—˜ì )"
              action: "Range ì œí•œ ì•ˆ í•¨, reasoningì—ë§Œ ì‚¬ìš©"
          
          sources_11:
            physical_3:
              - "SpacetimeConstraint (ì‹œê³µê°„ ì œì•½)"
              - "ConservationLaw (ë³´ì¡´ ë²•ì¹™)"
              - "MathematicalDefinition (ìˆ˜í•™ ì •ì˜)"
            soft_3:
              - "LegalNorm (ë²•ë¥  ê·œë²”)"
              - "StatisticalPattern (í†µê³„ íŒ¨í„´)"
              - "BehavioralInsight (í–‰ë™ê²½ì œí•™)"
            value_5:
              - "DefiniteData (í™•ì • ë°ì´í„°)"
              - "LLMEstimation (LLM ì¶”ì •)"
              - "WebSearch (ì›¹ ê²€ìƒ‰)"
              - "RAGBenchmark (RAG ë²¤ì¹˜ë§ˆí¬)"
              - "StatisticalValue (í†µê³„ ê°’)"
          
          calculation_logic:
            step_1_absolute_bounds:
              description: "ë¬¼ë¦¬ì /ë…¼ë¦¬ì  ì ˆëŒ€ ë²”ìœ„"
              examples:
                - "min = 0 (ìŒìˆ˜ ë¶ˆê°€)"
                - "max = ì¸êµ¬ Ã— 10 (ë¹„í˜„ì‹¤ ì œí•œ)"
            
            step_2_hard_guardrail_application:
              description: "Stage 1 ìˆ˜ì§‘ hard_guardrails ì ìš©"
              action:
                - "hard_upper â†’ max = min(max, guard.value)"
                - "hard_lower â†’ min = max(min, guard.value)"
            
            step_3_11_sources:
              description: "11ê°œ Sourceì—ì„œ hard constraints ì¶”ì¶œ"
              action: "ì¶”ê°€ ì œì•½ìœ¼ë¡œ Range ì¢íˆê¸°"
            
            step_4_intersection:
              description: "ëª¨ë“  ì œì•½ì˜ êµì§‘í•©"
              result: "final_range = [max(all_mins), min(all_maxs)]"

        phase_4_fermi_decomposition:
          name: "Phase 4 - Fermi Decomposition (Point)"
          role: "ë¬¸ì œë¥¼ ë¶„í•´í•˜ì—¬ ê°œë³„ ìš”ì†Œ ì¶”ì • í›„ ë‹¨ì¼ ê°’ ì‚°ì¶œ"
          speed: "10-30ì´ˆ"
          focus: "ë¬¼ë¦¬ì /ìˆ˜í•™ì  ë¶„í•´ (ë¹„ì¦ˆë‹ˆìŠ¤ ì§€í‘œ ê³„ì‚°ì€ Quantifier)"
          
          uses_guardrails:
            description: "Stage 1-3 ìˆ˜ì§‘ guardrailsë¥¼ ë¶„í•´/ë³€ìˆ˜ ìˆ˜ì¤€ì— ì ìš©"
            examples:
              - "ë³€ìˆ˜ ì¡°í•©ì´ ê²½ì œí™œë™ì¸êµ¬ ìƒí•œ ë„˜ì§€ ì•Šë„ë¡ ì œí•œ"
              - "ë¹„ìœ¨ í•©ì´ 1 ë„˜ì§€ ì•Šë„ë¡ ì œí•œ"
              - "ë¶ˆê°€ëŠ¥ ì¡°í•© (ìŒìˆ˜, 100% ì´ˆê³¼) ì œê±°"
          
          internal_steps:
            step_1_scan: "ê°€ìš© ë°ì´í„° ìŠ¤ìº” (Bottom-up, ë¶€ëª¨ ë°ì´í„° ìƒì†)"
            step_2_generate: "3-5ê°œ ë¶„í•´ ëª¨í˜• ìƒì„± (Top-down)"
            step_3_feasibility: "Unknown ë³€ìˆ˜ ì¬ê·€ ì¶”ì • + ì‹¤í–‰ ê°€ëŠ¥ì„± ì ìˆ˜"
            step_4_execute: "Backtracking, ì•ˆì „ ì‹¤í–‰, Confidence ì¡°í•©, Trace ìƒì„±"
          
          safety:
            max_depth: 4
            variable_limit: 10
            circular_detection: "Call stack ê¸°ë°˜ ìˆœí™˜ ì˜ì¡´ì„± ê°ì§€"
            phase_3_fallback: "ê¹Šì´ í•œê³„/guardrail ë°˜ë³µ ìœ„ë°˜ ì‹œ Range ê¸°ë°˜ ì¬í‰ê°€"

      # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      # Guardrail System
      # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      guardrail_system:
        
        collector:
          name: "GuardrailCollector"
          purpose: "ëª¨ë“  Phaseì—ì„œ ìˆ˜ì§‘í•œ ì œì•½ ì¡°ê±´ ì¤‘ì•™ ê´€ë¦¬"
          
          stores:
            definite_values:
              type: "List[EstimationResult]"
              description: "Phase 0-2ì—ì„œ ìˆ˜ì§‘í•œ í™•ì •ê°’"
            
            hard_guardrails:
              type: "List[Guardrail]"
              description: "ë…¼ë¦¬ì ìœ¼ë¡œ 100% ì„±ë¦½í•˜ëŠ” ì œì•½"
              subtypes:
                - "hard_upper: ìƒí•œ (ë…¼ë¦¬ì )"
                - "hard_lower: í•˜í•œ (ë…¼ë¦¬ì )"
                - "logical: ë¬¼ë¦¬/ìˆ˜í•™ ì œì•½"
              confidence: "â‰¥ 0.90"
            
            soft_guardrails:
              type: "List[Guardrail]"
              description: "ê²½í—˜ì /í†µê³„ì  ì œì•½"
              subtypes:
                - "soft_upper: ìƒí•œ (ê²½í—˜ì )"
                - "soft_lower: í•˜í•œ (ê²½í—˜ì )"
                - "expected_range: ì¼ë°˜ ë²”ìœ„"
              confidence: "0.60-0.85"
        
        priority_order:
          rationale: "ì™¸ë¶€ ê²€ì¦ > í”„ë¡œì íŠ¸ ëª…ì‹œ > êµ¬ì¡°ì  > ê²½í—˜ì "
          order:
            1: "hard_guardrails_from_validator (ìµœìš°ì„ )"
            2: "hard_guardrails_from_project_data"
            3: "structural_constraints_from_rag"
            4: "soft_constraints (ì„¤ëª…ìš©)"
        
        application_points:
          phase_3:
            usage: "Hard guardrailsë§Œ ì‚¬ìš©í•˜ì—¬ Range ìƒì„±"
            action: "ë…¼ë¦¬ì ìœ¼ë¡œ í™•ì‹¤í•œ ì œì•½ìœ¼ë¡œ ë²”ìœ„ ì¢íˆê¸°"
          
          phase_4:
            usage: "Hard/Soft ëª¨ë‘ ì°¸ê³ "
            action: "ë¶„í•´ ëª¨í˜•/ë³€ìˆ˜ í›„ë³´ í•„í„°ë§"
          
          synthesis:
            usage: "Hard ìœ„ë°˜ ì‹œ ê°’ ì¡°ì •, Soft ìœ„ë°˜ ì‹œ ê²½ê³ "
            action: "ìµœì¢… ê°’/ë²”ìœ„ê°€ ì œì•½ ë§Œì¡±í•˜ë„ë¡ ë³´ì •"

      # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      # Implementation Guidance
      # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      implementation_guidance:
        
        code_structure:
          file: "umis_rag/agents/estimator/estimator.py"
          
          functions:
            stage_1:
              - "_stage1_collect(question, context) â†’ (definite_values, guardrails)"
              - "_check_project_data_sync() â†’ Phase 0"
              - "await asyncio.gather(phase1, phase2) â†’ Phase 1-2 ë³‘ë ¬"
            
            stage_2:
              - "_stage2_estimate(question, context, guardrails) â†’ (phase3, phase4)"
              - "await asyncio.gather(phase3.calculate_range(), phase4.estimate())"
            
            stage_3:
              - "_stage3_synthesis(phase3, phase4, guardrails) â†’ EstimationResult"
              - "_cross_validate(range, point)"
              - "_weighted_fusion(results, weights)"
              - "_guardrail_validate(value, guardrails)"
          
          classes:
            - "GuardrailCollector (definite_values, hard_guards, soft_guards)"
            - "Guardrail (type, value, confidence, is_hard, reasoning)"
            - "Phase3GuardrailRangeEngine (calculate_range)"
            - "Phase4FermiDecomposition (estimate)"
        
        testing_strategy:
          unit_tests:
            - "GuardrailCollector ë™ì‘"
            - "Phase 3 Range ìƒì„± (Hard only)"
            - "Phase 4 Point ì¶”ì •"
            - "Cross-Validation ë¡œì§"
            - "Weighted Fusion ê³„ì‚°"
          
          integration_tests:
            - "Stage 1-2-3 ì „ì²´ Flow"
            - "Fast Path (Phase 0-2 í™•ì •ê°’)"
            - "Slow Path (Phase 3-4 ë³‘ë ¬)"
            - "Guardrail ìœ„ë°˜ ì‹œë‚˜ë¦¬ì˜¤"
          
          validation_cases:
            - "'ìì˜ì—…ì ìˆ˜' â†’ 'ê°œì¸ì‚¬ì—…ì ìˆ˜', 'ê²½ì œí™œë™ì¸êµ¬ ìˆ˜' ê°€ë“œë ˆì¼"
            - "'ìŒì‹ì  ìˆ˜' â†’ 'ì‚¬ì—…ì ìˆ˜' ìƒí•œì„ "
            - "Phase 3 Range [20ë§Œ, 40ë§Œ] + Phase 4 Point 30ë§Œ â†’ Agreement"
        
        migration_path:
          from: "v7.9.0 Sequential"
          to: "v7.10.0 Hybrid"
          
          steps:
            week_1:
              - "GuardrailTypeì— HARD/SOFT ì¶”ê°€"
              - "GuardrailCollector êµ¬í˜„"
              - "Phase 3 â†’ Phase3GuardrailRangeEngine ì¬ì„¤ê³„"
            
            week_2:
              - "Phase 1-2 ë³‘ë ¬ ì‹¤í–‰"
              - "Phase 3-4 ë³‘ë ¬ ì‹¤í–‰"
            
            week_3:
              - "Synthesis êµ¬í˜„ (Cross-Validation + Fusion)"
              - "Guardrail Validation"
            
            week_4:
              - "GuardrailAnalyzer (LLM 2ë‹¨ê³„ ì²´ì¸)"
              - "Meta-Learning (Optional)"
            
            week_5:
              - "ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸ (130ê°œ)"
              - "A/B í…ŒìŠ¤íŠ¸ (v7.9.0 vs v7.10.0)"
              - "Phaseë³„ ì±…ì„ ì¸¡ì •"

      # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      # Expected Improvements
      # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      expected_improvements:
        
        metrics:
          phase_0_speed:
            before: "0.1ì´ˆ"
            after: "0.001ì´ˆ"
            improvement: "100ë°°"
          
          information_utilization:
            before: "ìœ ì‚¬ ë°ì´í„° ë²„ë¦¼"
            after: "ê°€ë“œë ˆì¼ë¡œ ë³€í™˜ 100%"
            improvement: "ì •ë³´ ì†ì‹¤ ì œê±°"
          
          cross_validation:
            before: "ë¶ˆê°€ëŠ¥"
            after: "Range âˆ‹ Point ê²€ì¦"
            improvement: "ì‹ ë¢°ë„ +15%"
          
          confidence:
            before: "0.70-0.80"
            after: "0.85-0.95 (Agreement ì‹œ)"
            improvement: "+15-20%"
          
          execution_time:
            before: "8ì´ˆ (Sequential)"
            after: "6ì´ˆ (Parallel)"
            improvement: "23% ë‹¨ì¶•"
        
        qualitative:
          - "Phase ì—­í•  ëª…í™• (Range vs Point)"
          - "Guardrail ì•ˆì •ì„± í–¥ìƒ (Hard/Soft ë¶„ë¦¬)"
          - "ë¶ˆí™•ì‹¤ì„± ì •ëŸ‰í™” (95% CI ì œê³µ)"
          - "ê²€ì¦ ê°€ëŠ¥ì„± (A/B í…ŒìŠ¤íŠ¸)"

