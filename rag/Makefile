# ========================================
# UMIS RAG Makefile
# ========================================

.PHONY: help dev dev-stop rebuild test query stats clean release

help:
	@echo "ğŸ“š UMIS RAG ëª…ë ¹ì–´"
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo ""
	@echo "ê°œë°œ:"
	@echo "  make dev          - ê°œë°œ ëª¨ë“œ (YAML ìë™ ë°˜ì˜)"
	@echo "  make dev-stop     - ê°œë°œ ëª¨ë“œ ì¤‘ë‹¨"
	@echo "  make rebuild      - ì „ì²´ ì¬êµ¬ì¶•"
	@echo ""
	@echo "í…ŒìŠ¤íŠ¸:"
	@echo "  make test         - ê²€ìƒ‰ í…ŒìŠ¤íŠ¸"
	@echo "  make query QUERY='í”Œë«í¼' - ë¹ ë¥¸ ê²€ìƒ‰"
	@echo "  make stats        - ì¸ë±ìŠ¤ í†µê³„"
	@echo ""
	@echo "ë°°í¬:"
	@echo "  make release      - ë°°í¬ íŒ¨í‚¤ì§€"
	@echo ""
	@echo "ê´€ë¦¬:"
	@echo "  make clean        - ì²­í¬ ì‚­ì œ"
	@echo ""

dev:
	@echo "ğŸš€ ê°œë°œ ëª¨ë“œ ì‹œì‘"
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo ""
	@echo "ğŸ’¡ YAML ìˆ˜ì • â†’ 2ì´ˆ â†’ ìë™ ë°˜ì˜!"
	@echo "âš ï¸  ì¢…ë£Œ: Ctrl+C"
	@echo ""
	@source venv/bin/activate && python scripts/dev_watcher.py

dev-stop:
	@pkill -f dev_watcher.py || echo "âœ… ì¤‘ë‹¨ë¨"

rebuild:
	@echo "ğŸ”„ ì „ì²´ ì¬êµ¬ì¶•..."
	@source venv/bin/activate && \
		python scripts/01_convert_yaml.py && \
		python scripts/02_build_index.py --agent steve
	@echo "âœ… ì™„ë£Œ!"

test:
	@source venv/bin/activate && python scripts/03_test_search.py --agent steve

query:
	@source venv/bin/activate && python scripts/query_rag.py pattern "$(QUERY)"

stats:
	@source venv/bin/activate && python -c "import chromadb; client = chromadb.PersistentClient(path='data/chroma'); cols = client.list_collections(); print('ğŸ“Š RAG í†µê³„:'); [print(f'  {col.name}: {col.count()} docs') for col in cols]"

clean:
	@rm -rf data/chunks/* data/chroma/*
	@echo "âœ… ì •ë¦¬ ì™„ë£Œ"

release:
	@echo "ğŸ“¦ ë°°í¬ íŒ¨í‚¤ì§€ ìƒì„±..."
	@python scripts/build_release.py

