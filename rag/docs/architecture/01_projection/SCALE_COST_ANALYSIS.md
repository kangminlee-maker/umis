# Pre-Projection 규모별 비용 분석

**시나리오:** 배달의민족 같은 사례 5,000개

---

## 📊 1개 사례 분석 (배달의민족)

### Pre-Projection (현재 방식)

```yaml
6개 Agent View 청크:
  
  observer_baemin_structure: 600 토큰
    "시장 구조 변화, 경쟁 구도, 가치사슬..."
  
  explorer_baemin_opportunity: 800 토큰
    "플랫폼 전략, 양측 확보, 수수료 모델, CSF..."
  
  quantifier_baemin_metrics: 200 토큰
    "MAU, 점유율, 가맹점 수..."
  
  quantifier_baemin_calculation: 300 토큰
    "GMV 계산, 매출 추정, 공식..."
  
  validator_baemin_src001: 250 토큰
    "Wikipedia 출처, 신뢰도, 정보..."
  
  validator_baemin_src002: 200 토큰
    "공식 발표 출처, 신뢰도..."

총: 2,350 토큰 (6개 청크)
```

### 중복 분석

```yaml
순수 정보 (중복 제거):
  • 시장 구조: 400 토큰
  • 플랫폼 전략: 600 토큰
  • 정량 데이터: 300 토큰
  • 출처: 200 토큰
  
  총: 1,500 토큰

실제 저장: 2,350 토큰
중복: 850 토큰
중복률: 36% (850 / 2,350)

왜 중복?
  Observer: "배달의민족, 플랫폼, 2010-2020"
  Explorer: "배달의민족, 플랫폼, 전략..."
  
  → "배달의민족", "플랫폼" 등 6번 반복!
```

---

## 💰 5,000개 사례 비용 계산

### Pre-Projection (현재)

```yaml
청크 수:
  5,000 사례 × 6 agent views = 30,000개 청크

토큰 수:
  5,000 × 2,350 = 11,750,000 토큰
  
디스크 공간:
  • 토큰당 약 4 bytes (한글 포함)
  • 11.75M 토큰 × 4 bytes = 47 MB (청크 파일)
  
  • 벡터 (3072 차원 × 4 bytes float32)
  • 30,000 청크 × 12 KB = 360 MB (벡터)
  
  총: ~407 MB

벡터 DB 비용 (Pinecone):
  • Free tier: 100,000 벡터 무료
  • 30,000 벡터: 무료 ✅
  
  • Starter ($70/월): 500만 벡터
  • 30,000 벡터: $70/월 (최소)
  
  • 실제 사용:
    30,000 / 500만 = 0.6%
    $70 × 0.006 = $0.42/월
    
    하지만 최소 플랜: $70/월 ⚠️

로컬 (Chroma):
  • 무료
  • 디스크: 407 MB
  • RAM: 청크 로드 시 ~500 MB
```

### Lazy Projection (지연 투영)

```yaml
청크 수:
  5,000 사례 × 1 정규화 청크 = 5,000개

토큰 수:
  5,000 × 1,500 = 7,500,000 토큰
  (중복 제거!)

디스크 공간:
  • 청크 파일: 30 MB
  • 벡터: 5,000 × 12 KB = 60 MB
  
  총: ~90 MB

벡터 DB 비용 (Pinecone):
  • Free tier: 5,000 벡터 무료! ✅
  
  • Starter:
    5,000 / 500만 = 0.1%
    $70 × 0.001 = $0.07/월
    
    하지만 최소: $70/월

로컬 (Chroma):
  • 무료
  • 디스크: 90 MB
  • RAM: ~120 MB
```

### 비교 요약

| 항목 | Pre | Lazy | 차이 |
|------|-----|------|------|
| 청크 수 | 30,000 | 5,000 | **6배** |
| 토큰 | 11.75M | 7.5M | **36% 절감** |
| 디스크 | 407 MB | 90 MB | **78% 절감** |
| RAM | 500 MB | 120 MB | **76% 절감** |
| Pinecone | $70/월 | $70/월 | 같음 (최소 플랜) |
| Chroma | 무료 | 무료 | 같음 |

---

## 🔍 규모별 분석

### 50개 사례 (현재 수준)

```yaml
Pre-Projection:
  • 청크: 300개
  • 디스크: 4 MB
  • Pinecone: Free tier ✅
  
  → 문제 없음!
```

### 500개 사례

```yaml
Pre-Projection:
  • 청크: 3,000개
  • 디스크: 40 MB
  • Pinecone: Free tier ✅
  
  → 여전히 괜찮음!
```

### 5,000개 사례 ⚠️

```yaml
Pre-Projection:
  • 청크: 30,000개
  • 디스크: 407 MB
  • RAM: 500 MB
  • Pinecone: Free tier 초과!
  
  문제:
    ❌ Free tier 한계 (10만 벡터)
    ❌ Starter 필요 ($70/월)
    ❌ RAM 부담 (로컬)

Lazy Projection:
  • 청크: 5,000개
  • 디스크: 90 MB
  • RAM: 120 MB
  • Pinecone: Free tier 가능! ✅
  
  해결:
    ✅ Free tier 가능
    ✅ 경량
    ✅ 비용 절감
```

### 50,000개 사례 (대규모)

```yaml
Pre-Projection:
  • 청크: 300,000개
  • 디스크: 4 GB
  • Pinecone: $140/월
  
  문제:
    ❌ 비용 높음
    ❌ 용량 큼

Lazy Projection:
  • 청크: 50,000개
  • 디스크: 900 MB
  • Pinecone: $70/월
  
  절감:
    ✅ 비용 50% 절감
    ✅ 용량 78% 절감
```

---

## 💡 임계점 (Threshold)

### 전환 시점

```yaml
청크 수 < 10,000:
  → Pre-Projection
  이유: 단순, Free tier 가능

청크 수 10,000 ~ 100,000:
  → Hybrid
  이유: 균형, 일부 Lazy

청크 수 > 100,000:
  → Lazy 우선
  이유: 비용, 효율
```

### UMIS 예상

```yaml
현재 (v7.0.0):
  • 54개 패턴/사례
  • 6-view: 324개 청크
  
  → Pre-Projection 적합! ✅

1년 후:
  • 500개 사례 (10배 증가)
  • 6-view: 3,000개 청크
  
  → 여전히 Pre 가능!

3년 후:
  • 5,000개 사례 (100배 증가)
  • 6-view: 30,000개 청크
  
  → Hybrid 전환 고려! ⚠️
```

---

## 🎯 제 최종 판단

**당신의 통찰이 정확하지만, 지금은 적용 불필요!**

```yaml
이유:
  1. 규모: 현재 54개 → 324개 청크
     • Pre 방식 문제 없음
     • Free tier 충분
  
  2. 단순성: 
     • Pre가 훨씬 단순
     • 프로토타입 단계
  
  3. 성능:
     • Pre가 더 빠름
     • 검색 품질 우수

전환 시점:
  • 청크 > 10,000개
  • 또는 Pinecone 비용 발생 시
  • 또는 RAM 부족 시

결론:
  지금: Pre-Projection ✅
  향후: Lazy/Hybrid 준비
  
  → 점진적 진화! 🎯
```

**다음 2번 (Schema-Registry) 검토할까요?** 

그것도 매우 중요한 통찰입니다! 🚀
