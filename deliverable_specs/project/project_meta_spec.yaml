# ========================================
# Project Metadata Specification
# ========================================
#
# Agent: Stewart (Guardian) - 자동 관리
# Output: .project_meta.yaml
# Format: Pure YAML
# Purpose: 프로젝트 상태 및 진행 추적
#
# ========================================

spec_meta:
  spec_version: "1.1"
  manager: "guardian"
  output_format: "yaml"
  deliverable_type: "project_metadata"
  auto_managed: true
  created: "2025-11-08"
  updated: "2025-11-26"
  version: "7.11.0"

output_file:
  filename: ".project_meta.yaml"
  location: "00_overview/"
  hidden: true
  auto_update: "주요 이벤트마다"

# ========================================
# YAML Schema
# ========================================

yaml_schema:

  project_identification:
    project_id:
      type: "string"
      format: "UUID"
      auto_generate: true

    project_name:
      type: "string"
      format: "YYYYMMDD_descriptive_name"
      example: "20241031_piano_subscription_market"

    folder_path:
      type: "string"
      format: "projects/{project_name}/"
      auto_generate: true

  timeline:
    start_date:
      type: "date"
      auto_generate: true

    start_time:
      type: "time"
      auto_generate: true

    end_date:
      type: "date"
      nullable: true
      auto_set: "프로젝트 종료 시"

    end_time:
      type: "time"
      nullable: true

    total_duration:
      type: "string"
      format: "N일"
      auto_calculate: true

  ownership:
    owner:
      type: "string"
      description: "사용자 이름"

  status_tracking:
    status:
      type: "enum"
      values: ["active", "paused", "archived"]
      default: "active"

    phase:
      type: "enum"
      values: ["discovery_sprint", "analysis", "synthesis", "decision", "completed"]
      default: "discovery_sprint"

  clarity_evolution:
    initial_score:
      type: "integer"
      range: "1-10"

    current_score:
      type: "integer"
      range: "1-10"
      updatable: true

    target_score:
      type: "integer"
      default: 7

    evolution_log:
      type: "array"
      item_schema:
        - date: "YYYY-MM-DD"
        - score: "1-10"
        - phase: "discovery/analysis/etc"
        - reason: "변화 이유"

  discovery_sprint:
    type:
      type: "enum"
      values: ["fast_track", "full_sprint"]
      nullable: true

    start_date: {type: "date", nullable: true}
    target_completion: {type: "date", nullable: true}
    actual_completion: {type: "date", nullable: true}
    completed: {type: "boolean", default: false}

    findings:
      type: "array"
      description: "주요 발견사항"

  agents_tracking:
    agents_involved:
      type: "array"
      default: ["guardian"]  # Stewart 항상 포함
      values: ["validator", "quantifier", "observer", "explorer", "guardian"]

    agents_activity:
      type: "object"
      schema:
        validator:  # Rachel
          active: {type: "boolean", default: false}
          start_date: {type: "date", nullable: true}
          deliverables: {type: "integer", default: 0}

        quantifier:  # Bill
          active: {type: "boolean", default: false}
          start_date: {type: "date", nullable: true}
          deliverables: {type: "integer", default: 0}

        observer:  # Albert
          active: {type: "boolean", default: false}
          start_date: {type: "date", nullable: true}
          deliverables: {type: "integer", default: 0}

        explorer:  # Steve
          active: {type: "boolean", default: false}
          start_date: {type: "date", nullable: true}
          deliverables: {type: "integer", default: 0}

  milestones:
    type: "array"
    item_schema:
      - milestone: "이름"
      - date: "YYYY-MM-DD"
      - status: "completed/pending"

  deliverables_summary:
    deliverables_count:
      validator: {type: "integer", default: 0}
      quantifier: {type: "integer", default: 0}
      observer: {type: "integer", default: 0}
      explorer: {type: "integer", default: 0}
      total: {type: "integer", auto_calculate: true}

    deliverables_registry_file:
      fixed_value: "00_overview/deliverables_registry.yaml"

  validation_tracking:
    validation_summary:
      total_validations: {type: "integer", default: 0}
      passed: {type: "integer", default: 0}
      partial: {type: "integer", default: 0}
      failed: {type: "integer", default: 0}

    checkpoints:
      checkpoint_1_observer:  # Albert
        status: "pending/passed/partial/failed"
        date: {nullable: true}
        validators: ["quantifier", "validator", "guardian"]

      checkpoint_2_explorer:  # Steve
        status: "pending/passed/partial/failed"
        date: {nullable: true}
        validators: ["observer", "quantifier", "validator"]

      checkpoint_3_quantifier:  # Bill
        status: "pending/passed/partial/failed"
        date: {nullable: true}
        validators: ["validator", "observer"]

      checkpoint_4_owner:
        status: "pending/passed/partial/failed"
        date: {nullable: true}
        validators: ["guardian"]

  quality_metrics:
    data_reliability:
      type: "integer"
      range: "0-100"
      source: "validator 평균 신뢰도"
      nullable: true

    calculation_accuracy:
      type: "number"
      description: "quantifier 수렴도 (±%)"
      nullable: true

    analysis_completeness:
      type: "number"
      description: "산출물 완료율 (%)"
      auto_calculate: true

    validation_pass_rate:
      type: "number"
      description: "검증 통과율 (%)"
      auto_calculate: true

    overall_grade:
      type: "enum"
      values: ["A", "B", "C", "D"]
      criteria:
        A: "90%+"
        B: "70-89%"
        C: "50-69%"
        D: "<50%"
      nullable: true

  key_findings:
    type: "array"
    item_schema:
      - finding: "발견사항 내용"
      - date: "YYYY-MM-DD"
      - phase: "discovery/analysis/etc"
      - impact: "high/medium/low"

  pivot_history:
    type: "array"
    item_schema:
      - date: "YYYY-MM-DD"
      - from: "이전 방향"
      - to: "새 방향"
      - reason: "피벗 이유"
      - clarity_change: "score1 → score2"

  decisions:
    type: "array"
    item_schema:
      - decision: "결정 내용"
      - date: "YYYY-MM-DD"
      - rationale: "근거"
      - impact: "major/minor"

  metadata:
    created_by:
      fixed_value: "guardian"  # Stewart
      display: "Stewart (Guardian)"

    created_at:
      type: "datetime"
      auto_generate: true

    last_updated:
      type: "datetime"
      auto_update: true

    version:
      type: "string"
      default: "1.0"

    umis_version:
      fixed_value: "6.2"

  archive_info:
    archived:
      type: "boolean"
      default: false

    archive_date: {nullable: true}
    archive_location: {nullable: true}
    archive_size: {nullable: true}

# ========================================
# Auto Update Triggers
# ========================================

auto_update_triggers:

  on_agent_start:
    trigger: "에이전트가 작업 시작"
    update:
      - "agents_involved에 추가"
      - "agents_activity.{agent}.active = true"
      - "agents_activity.{agent}.start_date = today"

  on_deliverable_complete:
    trigger: "[DELIVERABLE_COMPLETE] 신호"
    update:
      - "deliverables_count.{agent} += 1"
      - "deliverables_count.total += 1"

  on_clarity_change:
    trigger: "명확도 점수 업데이트"
    update:
      - "current_score = new_score"
      - "evolution_log에 entry 추가"

  on_validation_complete:
    trigger: "검증 완료"
    update:
      - "validation_summary.total += 1"
      - "validation_summary.{result} += 1"
      - "checkpoints.{checkpoint}.status 업데이트"

  on_project_end:
    trigger: "[PROJECT_END]"
    update:
      - "status = 'archived'"
      - "end_date, end_time"
      - "total_duration 계산"
      - "overall_grade 계산"

# ========================================
# Example Output
# ========================================

example_output: |
  project_id: "550e8400-e29b-41d4-a716-446655440000"
  project_name: "20241031_piano_subscription_market"
  folder_path: "projects/20241031_piano_subscription_market/"

  timeline:
    start_date: "2024-10-31"
    start_time: "09:00:00"
    end_date: "2024-11-14"
    end_time: "18:30:00"
    total_duration: "14일"

  owner: "사용자명"

  status: "archived"
  phase: "completed"

  clarity:
    initial_score: 3
    current_score: 9
    target_score: 7
    evolution_log:
      - {date: "2024-10-31", score: 3, phase: "initial", reason: "프로젝트 시작"}
      - {date: "2025-11-02", score: 6, phase: "discovery", reason: "방향 수렴"}
      - {date: "2024-11-14", score: 9, phase: "completed", reason: "분석 완료"}

  discovery_sprint:
    type: "full_sprint"
    start_date: "2024-10-31"
    target_completion: "2025-11-02"
    actual_completion: "2025-11-02"
    completed: true
    findings:
      - "B2C 직판 구조 확인"
      - "구독 모델 유망"

  agents_involved: ["guardian", "validator", "quantifier", "observer", "explorer"]

  agents_activity:
    validator:
      active: false
      start_date: "2024-10-31"
      deliverables: 2
    quantifier:
      active: false
      start_date: "2025-11-03"
      deliverables: 2
    observer:
      active: false
      start_date: "2025-11-03"
      deliverables: 1
    explorer:
      active: false
      start_date: "2024-11-08"
      deliverables: 4

  milestones:
    - {milestone: "Discovery Sprint 완료", date: "2025-11-02", status: "completed"}
    - {milestone: "시장 구조 분석 완료", date: "2024-11-07", status: "completed"}
    - {milestone: "기회 발굴 완료", date: "2024-11-12", status: "completed"}
    - {milestone: "최종 의사결정", date: "2024-11-14", status: "completed"}

  deliverables_count:
    validator: 2
    quantifier: 2
    observer: 1
    explorer: 4
    total: 9

  validation_summary:
    total_validations: 4
    passed: 4
    partial: 0
    failed: 0

  quality_metrics:
    data_reliability: 82
    calculation_accuracy: 11  # ±11%
    analysis_completeness: 100
    validation_pass_rate: 100
    overall_grade: "A"

  key_findings:
    - {finding: "B2C 직판 70% 구조", date: "2024-11-05", phase: "analysis", impact: "high"}
    - {finding: "구독 모델 270억 SAM", date: "2024-11-09", phase: "analysis", impact: "high"}

  metadata:
    created_by: "guardian"
    created_at: "2024-10-31 09:00:00"
    last_updated: "2024-11-14 18:30:00"
    version: "1.0"
    umis_version: "6.2"

