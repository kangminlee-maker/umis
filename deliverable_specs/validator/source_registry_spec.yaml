# ========================================
# Source Registry Specification
# ========================================
# 
# Agent: Rachel (Validator)
# Output: source_registry.yaml
# Format: Pure YAML
# Purpose: AI가 데이터 출처를 구조화하여 저장
# 
# ========================================

spec_meta:
  spec_version: "1.0"
  agent_id: "validator"
  agent_role: "Validator"
  agent_name: "Rachel"  # customizable
  output_format: "yaml"
  deliverable_type: "source_registry"

output_file:
  filename: "source_registry.yaml"
  location: "02_analysis/validator/data_sources/"
  
# ========================================
# YAML Schema
# ========================================

yaml_schema:
  
  root_structure:
    project_info:
      project_name: {type: "string", source: "project_meta"}
      created_date: {type: "date", auto: true}
      validator: {type: "string", fixed: "validator"}
      total_sources: {type: "integer", auto_calculate: true}
    
    sources:
      type: "array"
      min_items: 1
      item_schema: "source_entry"

  source_entry_schema:
    
    required_fields:
      
      source_id:
        type: "string"
        format: "SRC_YYYYMMDD_NNN"
        auto_generate: true
        example: "SRC_20241031_001"
        description: "고유 식별자"
      
      data_point:
        type: "string"
        max_length: 200
        example: "한국 피아노 시장 규모"
        description: "데이터 항목 설명"
      
      original_value:
        type: "string"
        example: "1,500억원"
        description: "원본 데이터 값 (불변)"
      
      source_name:
        type: "string"
        example: "한국문화예술위원회 2023 악기시장 보고서"
        description: "출처 기관/문서명 전체"
      
      source_url:
        type: "string"
        format: "url or filepath"
        example: "https://www.arko.or.kr/report/2023/music_market.pdf"
        description: "URL 또는 파일 경로"
      
      access_date:
        type: "date"
        format: "YYYY-MM-DD"
        auto_generate: true
        description: "데이터 수집일"
      
      collection_method:
        type: "enum"
        values: ["API", "크롤링", "구매", "직접조사", "공개자료", "인터뷰"]
        example: "공개자료"
      
      original_definition:
        type: "text"
        critical: true
        description: "원본 데이터의 정확한 정의 (매우 중요!)"
        example: "악기 시장 = 신품 판매만, 중고/렌탈 제외, 2023년 기준"
      
      needed_definition:
        type: "text"
        description: "우리가 필요한 정의"
        example: "피아노 판매 시장 = 신품 + 중고 포함"
      
      definition_gap:
        type: "text"
        critical: true
        description: "원본 vs 필요 정의의 차이 분석"
        example: "중고 시장 미포함 → 과소 추정 가능성"
      
      adjustment_applied:
        type: "boolean"
        description: "조정 여부"
      
      reliability_score:
        type: "integer"
        range: "0-100"
        criteria:
          90-100: "정부 통계, 감사받은 재무제표"
          70-89: "민간 조사, 표본조사"
          50-69: "추정 포함, 오래된 자료"
          0-49: "출처 불명, 신뢰 불가"
    
    conditional_fields:
      
      data_creation_date:
        required_when: "source_type = '공개자료'"
        type: "date"
        description: "데이터 생성/발행 날짜"
      
      adjustment_logic:
        required_when: "adjustment_applied = true"
        type: "text"
        critical: true
        description: "조정 방법과 논리 (반드시 투명하게)"
        example: "업계 추정 중고 비중 20% 적용 → 1,500억 × 1.2 = 1,800억"
      
      adjusted_value:
        required_when: "adjustment_applied = true"
        type: "string"
        description: "조정된 값"
      
      verification_notes:
        type: "text"
        description: "검증 과정의 특이사항"
      
      update_cycle:
        type: "string"
        example: "연 1회 (매년 12월)"
      
      used_by:
        type: "array"
        description: "이 데이터를 사용한 곳"
        example: ["bill_sam_calculation", "observer_market_structure"]

# ========================================
# Validation Rules
# ========================================

validation_rules:
  
  completeness:
    - all_required_fields_present: true
    - source_id_unique: true
    - source_id_format_valid: "SRC_YYYYMMDD_NNN"
  
  definition_gap_analysis:
    - original_definition_not_empty: true
    - needed_definition_not_empty: true
    - definition_gap_analyzed: true
    - gap_impact_assessed: "과대/과소/범위차이"
  
  adjustment_logic:
    - if_adjusted_then_logic_required: true
    - logic_transparency: "제3자가 이해 가능해야 함"
    - calculation_traceable: "계산 과정 명시"
  
  reliability:
    - score_in_range: "0-100"
    - score_criteria_matched: true
    - avg_reliability_target: ">= 70"

# ========================================
# AI Usage
# ========================================

ai_usage:
  
  data_collection_workflow:
    step_1: "Validator가 데이터 발견"
    step_2: "이 spec 로드"
    step_3: "source_entry 생성"
    step_4: "필수 필드 채우기"
    step_5: "정의 Gap 분석"
    step_6: "조정 필요시 adjustment_logic 작성"
    step_7: "source_registry.yaml에 추가"
    step_8: "total_sources 자동 증가"
  
  integration_with_quantifier:
    purpose: "Bill이 Assumptions 작성 시 SRC_ID 참조"
    workflow:
      - "Bill: 데이터 필요"
      - "Rachel source_registry에서 SRC_ID 확인"
      - "Bill Assumptions Source 컬럼에 SRC_ID 기재"
      - "Bill Excel 셀 코멘트에 SRC_ID + 정의 명시"

# ========================================
# Example Entry
# ========================================

example_entry:
  direct_data: |
    - source_id: "SRC_20241031_001"
      data_point: "한국 전체 음악학원 수"
      original_value: "10,000개"
      source_name: "교육부 2023년 학원 현황 통계"
      source_url: "https://www.moe.go.kr/statistics/2023/academy_stats.pdf"
      access_date: "2024-10-31"
      data_creation_date: "2023-12-31"
      collection_method: "공개자료"
      original_definition: "교육부 등록 음악학원 전수, 피아노/기타/바이올린 등 모두 포함"
      needed_definition: "전체 음악학원 수 (정의 일치)"
      definition_gap: "없음 - 정의 완전 일치"
      adjustment_applied: false
      adjustment_logic: null
      adjusted_value: null
      reliability_score: 95
      verification_notes: "정부 공식 통계, 전수조사 기반"
      update_cycle: "연 1회 (매년 12월)"
      used_by: ["quantifier_asm_001", "observer_market_structure"]
  
  adjusted_data: |
    - source_id: "SRC_20241031_002"
      data_point: "서울 지역 피아노 학원 비중"
      original_value: "35%"
      source_name: "서울시 교육청 2024년 예술학원 샘플 조사"
      source_url: "https://seoul.go.kr/education/2024/arts_survey.pdf"
      access_date: "2024-10-31"
      data_creation_date: "2024-06-30"
      collection_method: "공개자료"
      original_definition: "서울 강남/서초/송파 음악학원 중 피아노 전문, 표본 100개"
      needed_definition: "전국 피아노 학원 비중"
      definition_gap: "지역: 서울 고소득지역만 → 전국 필요, 표본: 100개 → 대표성 제한"
      adjustment_applied: true
      adjustment_logic: "서울 고소득 35% → 전국 보정 0.85 = 29.75% → 보수적 30%"
      adjusted_value: "30%"
      reliability_score: 70
      verification_notes: "표본 작고 지역 편향, 보정 계수는 소득 수준 고려"
      update_cycle: "연 2회"
      used_by: ["quantifier_est_001"]

