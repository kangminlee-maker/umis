# ========================================
# Market Sizing Workbook Specification
# ========================================
# 
# Agent: Bill (Quantifier)
# Output: market_sizing_[name].xlsx (9 sheets)
# Format: Excel with formulas
# Purpose: SAM ê³„ì‚°ì˜ ì™„ì „í•œ ì¬í˜„ ê°€ëŠ¥ì„± ë³´ì¥
# 
# ========================================

spec_meta:
  spec_version: "1.0"
  agent_id: "quantifier"
  agent_role: "Quantifier"
  agent_name: "Bill"  # customizable
  output_format: "xlsx"
  deliverable_type: "market_sizing_workbook"

output_file:
  naming_convention: "market_sizing_{market_name}.xlsx"
  location: "02_analysis/quantifier/market_sizing/"
  total_sheets: 9
  backup_required: "PDF (í•¨ìˆ˜ ì—†ì´ë„ ê²€ì¦ ê°€ëŠ¥)"

# ========================================
# Sheet Specifications
# ========================================

sheets:
  
  sheet_1_assumptions:
    name: "Assumptions"
    order: 1
    purpose: "ëª¨ë“  ê°€ì •ê³¼ ì „ì œ ì¡°ê±´ ëª…ì‹œ"
    
    columns:
      - name: "ID"
        type: "text"
        format: "ASM_001, ASM_002, ..."
        auto_increment: true
      
      - name: "Category"
        type: "enum"
        values: ["ì¸êµ¬", "ê°€ê²©", "ë¹ˆë„", "ë¹„ìœ¨", "ê¸°íƒ€"]
      
      - name: "Description"
        type: "text"
        max_length: 100
      
      - name: "Value"
        type: "number"
        format: "ì²œë‹¨ìœ„ ì‰¼í‘œ"
      
      - name: "Unit"
        type: "text"
        examples: ["ëª…", "ê°œ", "ì›", "%", "íšŒ"]
      
      - name: "Data_Type"
        type: "enum"
        values: ["ì§ì ‘ë°ì´í„°", "ì¶”ì •ì¹˜"]
        critical: true
        color_coding:
          ì§ì ‘ë°ì´í„°: "#FFF9C4"  # ë…¸ë€ìƒ‰
          ì¶”ì •ì¹˜: "#BBDEFB"      # íŒŒë€ìƒ‰
      
      - name: "Source"
        type: "string"
        format: "SRC_YYYYMMDD_NNN or EST_NNN"
        validation: "ë°˜ë“œì‹œ ì¡´ì¬í•˜ëŠ” SRC_ID ë˜ëŠ” EST_ID"
        cell_comment_required: true
      
      - name: "Confidence"
        type: "enum"
        values: ["High", "Medium", "Low"]
      
      - name: "Notes"
        type: "text"
        description: "ê°„ë‹¨ ì„¤ëª…, ìƒì„¸ëŠ” Source ì°¸ì¡°"
    
    formatting:
      header_row:
        background: "#757575"
        font_color: "white"
        bold: true
      
      data_rows:
        conditional_formatting:
          - condition: "Data_Type = 'ì§ì ‘ë°ì´í„°'"
            background: "#FFF9C4"
          - condition: "Data_Type = 'ì¶”ì •ì¹˜'"
            background: "#BBDEFB"
    
    cell_protection:
      locked: ["ID"]  # auto-increment
      unlocked: ["all others"]
  
  sheet_2_estimation_details:
    name: "Estimation_Details"
    order: 2
    purpose: "ì¶”ì •ì¹˜ì˜ 7ê°œ ì„¹ì…˜ íˆ¬ëª… ë¬¸ì„œí™” â­"
    critical: true
    note: "ì¬ê²€ì¦ ê°€ëŠ¥ì„±ì˜ í•µì‹¬ ì‹œíŠ¸!"
    
    structure:
      format: "EST_NNN ë¸”ë¡ë³„ ìƒì„¸ ë¬¸ì„œí™”"
      block_template: "7ê°œ ì„¹ì…˜"
    
    columns:
      - name: "EST_ID"
        type: "text"
        format: "EST_001, EST_002, ..."
      
      - name: "Item"
        type: "text"
        description: "ì¶”ì • í•­ëª©"
      
      - name: "Final_Value"
        type: "string"
        description: "ìµœì¢… ì¶”ì •ê°’"
      
      - name: "Used_In"
        type: "string"
        description: "ì‚¬ìš© ìœ„ì¹˜ (ASM_NNN)"
      
      - name: "Confidence"
        type: "enum"
        values: ["High", "Medium", "Low"]
      
      - name: "Error_Range"
        type: "string"
        example: "Â±10%p"
    
    detailed_documentation:
      location: "ê° í–‰ ìš°ì¸¡ ë˜ëŠ” í•˜ë‹¨ ì˜ì—­"
      
      seven_sections:
        
        section_1_reason:
          heading: "[1] ì¶”ì • í•„ìš” ì´ìœ "
          required_content:
            - "ì™œ ì§ì ‘ ë°ì´í„°ê°€ ì—†ëŠ”ê°€"
            - "ì–´ë–¤ ëŒ€ì•ˆì„ ì‹œë„í–ˆëŠ”ê°€"
        
        section_2_data_used:
          heading: "[2] ì‚¬ìš©í•œ ë°ì´í„°"
          format: "ë¦¬ìŠ¤íŠ¸"
          item_format: "ë°ì´í„° X: {ê°’} â† SRC_YYYYMMDD_NNN"
          validation: "ëª¨ë“  SRC_IDëŠ” source_registryì— ì¡´ì¬"
        
        section_3_logic:
          heading: "[3] ì¶”ì • ë…¼ë¦¬ (ë‹¨ê³„ë³„)"
          format: "Step 1-N êµ¬ì¡°"
          requirements:
            - "ê° ë‹¨ê³„ë§ˆë‹¤ ê³„ì‚° ëª…ì‹œ"
            - "ë³´ì • ê³„ìˆ˜ì˜ ê·¼ê±° ì„¤ëª…"
            - "ìµœì¢… ê°’ ë„ì¶œ ê³¼ì •"
        
        section_4_reliability:
          heading: "[4] ì‹ ë¢°ë„ í‰ê°€"
          required_items:
            - confidence: "High/Medium/Low"
            - error_range: "Â±X%"
            - sensitivity: "SAMì— ë¯¸ì¹˜ëŠ” ì˜í–¥ %"
            - risk: "ë¦¬ìŠ¤í¬ í‰ê°€"
        
        section_5_verification:
          heading: "[5] ê²€ì¦ ë°©ë²•"
          required_tests:
            - upper_bound: "ìƒí•œ í…ŒìŠ¤íŠ¸"
            - lower_bound: "í•˜í•œ í…ŒìŠ¤íŠ¸"
            - benchmark: "ë²¤ì¹˜ë§ˆí¬ ë¹„êµ"
        
        section_6_alternatives:
          heading: "[6] ëŒ€ì²´ ì ‘ê·¼ë²• ì‹œë„"
          format: "ì‹œë„ N: {ë°©ë²•} â†’ {ê²°ê³¼} â†’ {ì‚¬ìœ }"
          purpose: "ì™œ í˜„ì¬ ì¶”ì •ì´ ìµœì„ ì¸ì§€ ì¦ëª…"
        
        section_7_usage:
          heading: "[7] ì‚¬ìš© ìœ„ì¹˜"
          content:
            - "Assumptions ì‹œíŠ¸: ASM_NNN"
            - "Method ì‹œíŠ¸: ì–´ë””ì— ì‚¬ìš©"
            - "ì˜í–¥ ë²”ìœ„: ìƒì„¸"
  
  sheet_3_method_1_topdown:
    name: "Method_1_TopDown"
    order: 3
    purpose: "TAM â†’ SAM í•˜í–¥ì‹ ê³„ì‚°"
    flexibility: "2-5ë‹¨ê³„ narrowing ì§€ì›"
    
    column_structure:
      flexible: true
      description: "ì‹œì¥ íŠ¹ì„±ì— ë”°ë¼ ì»¬ëŸ¼ ìˆ˜ ì¡°ì •"
      
      minimum_columns: 3  # TAM, Narrowing 1, SAM
      maximum_columns: 7  # TAM, Narrowing 1-5, SAM
      
      each_column:
        row_1: "ë‹¨ê³„ ëª…ì¹­ (ì˜ˆ: ì§€ì—­ ì¶•ì†Œ)"
        row_2: "ì¶•ì†Œ ë¹„ìœ¨ (=Assumptions!B10)"
        row_3: "ê³„ì‚° ê²°ê³¼ (=ì´ì „*ë¹„ìœ¨)"
        row_4: "ì¶œì²˜ (ì…€ ì½”ë©˜íŠ¸)"
    
    validation_area:
      location: "ì‹œíŠ¸ í•˜ë‹¨ (Row 10 ì´í•˜)"
      required_checks:
        - test: "ë…¼ë¦¬ì  ìƒí•œ"
          formula: "=IF(SAM < TAM, 'âœ…', 'ğŸš«')"
        - test: "ë…¼ë¦¬ì  í•˜í•œ"
          formula: "=IF(SAM > {known_minimum}, 'âœ…', 'ğŸš«')"
        - test: "ë¹„ìœ¨ í•©ë¦¬ì„±"
          formula: "=IF(AND(all_ratios_0_to_100%), 'âœ…', 'ğŸš«')"
        - test: "ìµœì¢… íƒ€ë‹¹ì„±"
          formula: "=IF(AND(ìƒí•œ, í•˜í•œ, ë¹„ìœ¨), 'âœ… í†µê³¼', 'ğŸš« ì¬ê²€í† ')"
  
  sheet_4_method_2_bottomup:
    name: "Method_2_BottomUp"
    order: 4
    purpose: "êµ¬ì„± ìš”ì†Œ ì ì‚° ê³„ì‚°"
    
    structure:
      format: "ì„¸ê·¸ë¨¼íŠ¸ë³„ í–‰"
      formula: "ìˆ˜ëŸ‰ Ã— ë¹ˆë„ Ã— ë‹¨ê°€ Ã— ê¸°ê°„"
      total: "SUM(ì„¸ê·¸ë¨¼íŠ¸ë“¤)"
    
    universal_formulas:
      b2c: "=ê³ ê°ìˆ˜ * êµ¬ë§¤ë¹ˆë„ * ê°ë‹¨ê°€ * 12"
      b2b: "=ê¸°ì—…ìˆ˜ * ë„ì…ë¥  * ë¼ì´ì„ ìŠ¤ë¹„ * ê°±ì‹ ìœ¨"
      platform: "=ê±°ë˜ê±´ìˆ˜ * í‰ê· ê±°ë˜ì•¡ * ìˆ˜ìˆ˜ë£Œìœ¨"
    
    cross_reference: "ëª¨ë“  ì…ë ¥ê°’ì€ Assumptions ì‹œíŠ¸ ì°¸ì¡°"
  
  sheet_5_method_3_proxy:
    name: "Method_3_Proxy"
    order: 5
    purpose: "ìœ ì‚¬ ì‹œì¥ ë¹„êµ ê²€ì¦"
    
    structure:
      benchmark_selection: "ìœ ì‚¬ ì‹œì¥ ì„ íƒ"
      adjustment_factors: ["ê²½ì œ ê·œëª¨", "ë¬¸í™”ì  ì°¨ì´", "ì¸í”„ë¼ ì°¨ì´"]
      final_estimate: "ë²¤ì¹˜ë§ˆí¬ Ã— ì¡°ì •ê³„ìˆ˜ë“¤"
  
  sheet_6_method_4_competitor:
    name: "Method_4_CompetitorRevenue"
    order: 6
    purpose: "ê²½ìŸì‚¬ ë§¤ì¶œ ê¸°ë°˜ ì—­ì‚°"
    
    columns:
      - "ê¸°ì—…ëª…"
      - "ì „ì²´ ë§¤ì¶œ"
      - "ì¶œì²˜ (ê³µì‹œ/IR í˜ì´ì§€)"
      - "ê²½ìŸì˜ì—­ ë¹„ì¤‘ (%)"
      - "ì¶”ì • ë…¼ë¦¬"  # EST_NNN ë˜ëŠ” ì§ì ‘ ê¸°ì¬
      - "ê²½ìŸ ë§¤ì¶œ (=ì „ì²´*ë¹„ì¤‘)"
    
    calculation:
      step_1: "Top N ê²½ìŸ ë§¤ì¶œ í•©ê³„"
      step_2: "ì‹œì¥ ì ìœ ìœ¨ ì¶”ì •"
      step_3: "ì—­ì‚° SAM = í•©ê³„ / ì ìœ ìœ¨"
    
    traceability_critical:
      - "ë¹„ì¤‘ ì¶”ì •ì‹œ ë°˜ë“œì‹œ ë…¼ë¦¬ ê¸°ì¬"
      - "ì‚¬ì—…ë³´ê³ ì„œ í˜ì´ì§€ ë²ˆí˜¸ ëª…ì‹œ"
      - "EST_NNN ì°¸ì¡° ì‹œ Estimation_Detailsì— ìƒì„¸"
  
  sheet_7_convergence:
    name: "Convergence_Analysis"
    order: 7
    purpose: "4ê°€ì§€ ë°©ë²• ìˆ˜ë ´ ë¶„ì„ â­"
    critical: true
    
    table_structure:
      rows:
        - "Method 1: Top-Down"
        - "Method 2: Bottom-Up"
        - "Method 3: Proxy"
        - "Method 4: Competitor"
        - "í‰ê· "
        - "í‘œì¤€í¸ì°¨"
        - "ë³€ë™ê³„ìˆ˜ (CV%)"
      
      columns:
        - "Result": "=Method_N!result_cell"
        - "ì°¨ì´ (vs í‰ê· )": "=B2-$B$7"
        - "ì°¨ì´%": "=C2/$B$7"
    
    formulas:
      average: "=AVERAGE(B2:B5)"
      stdev: "=STDEV(B2:B5)"
      cv: "=B8/B7"
    
    convergence_test:
      max_min_ratio: "=MAX(B2:B5)/MIN(B2:B5)"
      pass_30: "=IF(ratio<=1.3, 'âœ… í†µê³¼', 'âš ï¸')"
      pass_50: "=IF(ratio<=1.5, 'âœ… ìˆ˜ìš©', 'ğŸš«')"
    
    final_sam_selection:
      method: "ì¤‘ê°„ê°’ or ê°€ì¤‘í‰ê· "
      formula: "=MEDIAN(B2:B5)"
      confidence_interval: "Â±15% or Â±30%"
  
  sheet_8_scenarios:
    name: "Scenarios"
    order: 8
    purpose: "Best/Base/Worst Case ì‹œë‚˜ë¦¬ì˜¤"
    
    structure:
      variables_table:
        columns: ["ë³€ìˆ˜", "Worst", "Base", "Best", "ê·¼ê±°"]
        variables: "í•µì‹¬ ê°€ì •ë“¤"
      
      sam_calculation:
        formula: "ê° ì‹œë‚˜ë¦¬ì˜¤ë³„ SAM ì¬ê³„ì‚°"
      
      sensitivity_analysis:
        output: "ë³€ìˆ˜ë³„ SAM ì˜í–¥ë„ ìˆœìœ„"
  
  sheet_9_validation:
    name: "Validation_Log"
    order: 9
    purpose: "ê²€ì¦ ì´ë ¥ ê¸°ë¡"
    
    table_structure:
      columns: ["ê²€ì¦ì ID", "ê²€ì¦ìëª…", "ê²€ì¦ì¼", "í•­ëª©", "ê²°ê³¼", "ì˜ê²¬"]
      rows:
        - {validator_id: "validator", name: "Rachel", item: "ë°ì´í„° ì •ì˜"}
        - {validator_id: "validator", name: "Rachel", item: "ì‹ ë¢°ë„"}
        - {validator_id: "observer", name: "Albert", item: "êµ¬ì¡° ë¶€í•©ì„±"}
        - {validator_id: "observer", name: "Albert", item: "ë…¼ë¦¬ íƒ€ë‹¹ì„±"}
        - {validator_id: "guardian", name: "Stewart", item: "ìµœì¢… ìŠ¹ì¸"}

# ========================================
# Global Excel Settings
# ========================================

excel_settings:
  
  color_coding:
    input_direct: "#FFF9C4"     # ë…¸ë€ìƒ‰ (ì§ì ‘ë°ì´í„°)
    input_estimated: "#BBDEFB"  # íŒŒë€ìƒ‰ (ì¶”ì •ì¹˜)
    calculation: "#FFFFFF"      # í°ìƒ‰
    result: "#C8E6C9"          # ë…¹ìƒ‰
    warning: "#FFCDD2"         # ë¹¨ê°„ìƒ‰
    header: "#757575"          # íšŒìƒ‰ + í°ìƒ‰ ê¸€ì
  
  cell_comments:
    required_for:
      - "ëª¨ë“  ì…ë ¥ ì…€: ì¶œì²˜ (SRC_ID or EST_ID)"
      - "ëª¨ë“  ê°€ì • ì…€: ê·¼ê±° ë…¼ë¦¬"
      - "ë³µì¡í•œ ê³„ì‚° ì…€: ê³µì‹ ì„¤ëª…"
  
  cell_protection:
    locked: ["ê³„ì‚° ì…€", "ê²°ê³¼ ì…€"]
    unlocked: ["ì…ë ¥ ì…€"]
    password: null  # í˜‘ì—… ìš©ì´
  
  formula_rules:
    no_hardcoding: "ëª¨ë“  ìˆ«ìëŠ” Assumptions ì°¸ì¡°"
    absolute_reference: "=Assumptions!$D$5"
    named_ranges: "ê¶Œì¥ (ê°€ë…ì„±)"

# ========================================
# Validation Rules
# ========================================

validation_rules:
  
  structure_completeness:
    - all_9_sheets_exist: true
    - sheet_names_exact: true
    - sheet_order_correct: true
  
  estimation_details_check:
    - all_est_ids_documented: "Assumptionsì˜ ëª¨ë“  EST_IDê°€ Estimation_Detailsì— ì¡´ì¬"
    - seven_sections_complete: "ê° EST_NNNë§ˆë‹¤ 7ê°œ ì„¹ì…˜ ì‘ì„±"
    - all_src_ids_valid: "ì‚¬ìš©í•œ ëª¨ë“  SRC_IDê°€ validator.source_registryì— ì¡´ì¬"
  
  formula_check:
    - no_hardcoded_values: "ê³„ì‚° ì…€ì— ì§ì ‘ ìˆ«ì ì…ë ¥ ê¸ˆì§€"
    - all_calculations_use_formulas: "95% ì´ìƒ í•¨ìˆ˜ (ìƒìˆ˜ ì œì™¸)"
    - no_circular_references: true
  
  convergence_check:
    - four_methods_applied: true
    - convergence_within_30: "ê¶Œì¥"
    - convergence_within_50: "ìµœì†Œ"
    - convergence_analysis_complete: true
  
  backup_check:
    - pdf_exported: true
    - pdf_filename_correct: "market_sizing_{name}_YYYYMMDD.pdf"
    - all_sheets_in_pdf: true

# ========================================
# AI Generation Workflow
# ========================================

ai_workflow:
  
  creation:
    step_1: "Quantifierê°€ SAM ê³„ì‚° í•„ìš” ì¸ì‹"
    step_2: "ì´ spec ë¡œë“œ"
    step_3: "Excel íŒŒì¼ ìƒì„± (9ê°œ ì‹œíŠ¸)"
    step_4: "Assumptions ì‹œíŠ¸ ì‘ì„±"
    step_5: "Estimation_Details ì¶”ì • ë…¼ë¦¬ ë¬¸ì„œí™”"
    step_6: "Method 1-4 ê³„ì‚° (í•¨ìˆ˜ë¡œ)"
    step_7: "Convergence ë¶„ì„"
    step_8: "Scenarios, Validation ì‹œíŠ¸ ì‘ì„±"
    step_9: "PDF ë°±ì—… ìƒì„±"
    step_10: "[DELIVERABLE_COMPLETE] quantifier {filename}.xlsx"
  
  integration:
    with_validator:
      - "Assumptions Source ì»¬ëŸ¼ì— SRC_ID ì°¸ì¡°"
      - "Estimation_Details [2]ì—ì„œ SRC_ID ì‚¬ìš©"
      - "ê²€ì¦ ìš”ì²­: ë°ì´í„° ì •ì˜ í™•ì¸"
    
    with_observer:
      - "ì‹œì¥ êµ¬ì¡° ë¶„ì„ ê²°ê³¼ ì°¸ì¡°"
      - "ê²€ì¦ ìš”ì²­: êµ¬ì¡° ë¶€í•©ì„± í™•ì¸"

# ========================================
# Example Values
# ========================================

example_data:
  assumptions_row_direct: |
    ASM_001 | ì¸êµ¬ | ì „ì²´ ìŒì•…í•™ì› ìˆ˜ | 10,000 | ê°œ | ì§ì ‘ë°ì´í„° | SRC_20241031_001 | High | êµìœ¡ë¶€ í†µê³„
  
  assumptions_row_estimated: |
    ASM_002 | ë¹„ìœ¨ | í”¼ì•„ë…¸ í•™ì› ë¹„ì¤‘ | 30 | % | ì¶”ì •ì¹˜ | EST_001 | Medium | ìƒì„¸: EST_001
  
  estimation_details_block: |
    EST_001 | í”¼ì•„ë…¸ í•™ì› ë¹„ì¤‘ | 30% | ASM_002 | Medium | Â±10%p
    
    [ìƒì„¸ ë¬¸ì„œí™” ì˜ì—­]
    ============================================
    EST_ID: EST_001
    ì¶”ì • í•­ëª©: í”¼ì•„ë…¸ í•™ì› ë¹„ì¤‘
    ìµœì¢… ì¶”ì •ê°’: 30%
    ============================================
    
    [1] ì¶”ì • í•„ìš” ì´ìœ 
    - êµìœ¡ë¶€ í†µê³„ì— ì„¸ë¶€ êµ¬ë¶„ ì—†ìŒ
    
    [2] ì‚¬ìš©í•œ ë°ì´í„°
    - ì „ì²´ ìŒì•…í•™ì› 10,000ê°œ â† SRC_20241031_001
    - ì„œìš¸ ìƒ˜í”Œ 35% â† SRC_20241031_002
    - ê²€ìƒ‰ëŸ‰ 40:30 â† SRC_20241031_003
    
    [3] ì¶”ì • ë…¼ë¦¬
    Step 1: 35% Ã— 0.85 = 29.75%
    Step 2: ê²€ìƒ‰ëŸ‰ 40% êµì°¨ê²€ì¦
    Step 3: ë³´ìˆ˜ì  30% ì ìš©
    
    [4] ì‹ ë¢°ë„: Medium, Â±10%p, SAM ì˜í–¥ 30%
    [5] ê²€ì¦: ìƒí•œ <50%, í•˜í•œ >15%, ë²¤ì¹˜ë§ˆí¬ 28%
    [6] ëŒ€ì•ˆ: í˜‘íšŒ ë¬¸ì˜ ì‹¤íŒ¨, ì „ìˆ˜ì¡°ì‚¬ ì œì•½
    [7] ì‚¬ìš©: ASM_002, Method_2 ê³„ì‚°

