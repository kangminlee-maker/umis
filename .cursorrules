# ========================================
# UMIS RAG Cursor Rules - AI Optimized
# v7.0.0 | Non-coder | Cursor-only
# ========================================

# === PART 1: UMIS ê°œë… (AI í•„ìˆ˜ ì´í•´) ===

system:
  name: Universal Market Intelligence System
  version: 7.0.0
  
  agents:
    Observer: {name: Albert, role: market_structure, rag: false}
    Explorer: {name: Steve, role: opportunity_discovery, rag: true}  # ìœ ì¼!
    Quantifier: {name: Bill, role: market_sizing, rag: false}
    Validator: {name: Rachel, role: data_verification, rag: false}
    Guardian: {name: Stewart, role: process_monitoring, rag: false}
  
  # id: Agent ID (Observer, Explorer, ...)
  # name: Default name (Albert, Steve, ...) â†’ agent_names.yamlë¡œ ì»¤ìŠ¤í„°ë§ˆì´ì§•
  
  flow: Observer(observe)â†’Explorer(rag+hypothesize)â†’Quantifier(calculate)â†’Validator(verify)â†’Guardian(approve)
  
  discovery_sprint: ëª…í™•ë„<7 â†’ 5-Agent ë³‘ë ¬ íƒìƒ‰ â†’ ëª©í‘œ êµ¬ì²´í™”
  
  rag:
    active: Explorer only
    architecture: v3.0 (Canonical â†’ Projected â†’ Graph)
    layers:
      vector: data/chroma/ (canonical_index, projected_index)
      graph: Neo4j (optional, 13 patterns, 45 relationships)
      memory: Query/Goal/RAE Memory
    sources: 
      - data/raw/umis_business_model_patterns.yaml (31 patterns)
      - data/raw/umis_disruption_patterns.yaml (23 patterns)

user:
  skill: no-coding
  tool: Cursor Composer + Agent mode
  lang: í•œêµ­ì–´
  workflow: ëŒ€í™”â†’ìë™í™”â†’ê²°ê³¼

# === PART 2: ìë™í™” ê·œì¹™ ===

## ì´ˆê¸° ì„¤ì¹˜
setup:
  detect: ["umis ì„¤ì¹˜", "ì„¤ì •", "setup", "@setup"]
  
  flow:
    check_env:
      no: python setup/setup.py â†’ ìë™ ì„¤ì¹˜
      yes: python setup/setup.py --check â†’ ìƒíƒœ í™•ì¸
  
  commands:
    auto_install: python setup/setup.py
    minimal_install: python setup/setup.py --minimal
    check_status: python setup/setup.py --check
    build_index: python scripts/02_build_index.py --agent explorer
  
  guide: setup/AI_SETUP_GUIDE.md (AI ìë™ ì„¤ì¹˜ ê°€ì´ë“œ)
  
  messages:
    start: |
      ğŸš€ UMIS v7.0.0 ìë™ ì„¤ì¹˜ ì‹œì‘
      
      setup/AI_SETUP_GUIDE.md ì°¸ì¡°í•˜ì—¬ ì§„í–‰í•©ë‹ˆë‹¤.
      ì†Œìš” ì‹œê°„: 2-3ë¶„
    
    api_key: |
      âœ… .env ìƒì„± ì™„ë£Œ!
      
      ë‹¤ìŒ: .env íŒŒì¼ ì—´ì–´ì„œ
      OPENAI_API_KEY=your-key â†’ ìì‹ ì˜ í‚¤ë¡œ ë³€ê²½
      
      ë°›ê¸°: https://platform.openai.com/api-keys
    
    ready: |
      âœ… ì„¤ì¹˜ ì™„ë£Œ!
      
      ì‚¬ìš©: Cmd+I â†’ @umis.yaml
      "@Explorer, ì‹œì¥ ë¶„ì„í•´ì¤˜"

## Agent ì´ë¦„ ì»¤ìŠ¤í„°ë§ˆì´ì§•
agent_names:
  file: agent_names.yaml
  format: {observer: Albert, explorer: Steve, ...}
  bidirectional: true
  
  mapping:
    input: @Steve â†’ Explorer
    output: Explorer â†’ Steve
  
  defaults: {Observer: Albert, Explorer: Steve, Quantifier: Bill, Validator: Rachel, Guardian: Stewart}

## YAML ìˆ˜ì • â†’ RAG ì¬êµ¬ì¶•
yaml_watch:
  files: [umis_business_model_patterns.yaml, umis_disruption_patterns.yaml, umis_ai_guide.yaml]
  
  on_save:
    ask: "RAG ì¬êµ¬ì¶•? (2ì´ˆ)"
    if_yes: python scripts/01_convert_yaml.py â†’ python scripts/02_build_index.py --agent explorer
    msg: "âœ… RAG ì—…ë°ì´íŠ¸!"

## Explorer RAG ìë™ í™œìš©
explorer_rag:
  pattern_search:
    detect: ["íŒ¨í„´ ë§¤ì¹­", "íŠ¸ë¦¬ê±° ì‹œê·¸ë„"]
    cmd: python scripts/query_rag.py pattern "{signals}"
    msg: "ğŸ” {pattern_id} ë°œê²¬!"
  
  case_search:
    detect: ["ìœ ì‚¬ ì‚¬ë¡€", "ì„±ê³µ ì‚¬ë¡€"]
    cmd: python scripts/query_rag.py case "{industry}" --pattern {id}
    integrate: analysis

## ë°ì´í„° ì¶”ê°€
data_add:
  detect: ["ë°ì´í„° ì¶”ê°€", "ìˆ˜ì •", "ë„£ì–´ì¤˜"]
  
  flow:
    open_yaml â†’ find_section â†’ suggest_diff â†’
    if_approved: save â†’ rebuild_rag â†’ "âœ… ì™„ë£Œ!"
  
  example: "ì½”ì›¨ì´ í•´ì§€ìœ¨ ì¶”ê°€" â†’ umis_business_model_patterns.yaml ìë™ ìˆ˜ì •

## ë‹¨ì¶• ëª…ë ¹
shortcuts:
  - "rag ê²€ìƒ‰ {q}": python scripts/query_rag.py {q}
  - "rag ì¬êµ¬ì¶•": scripts/01+02
  - "rag í†µê³„": show collection stats
  - "rag í…ŒìŠ¤íŠ¸": scripts/03_test_search.py

# === PART 3: ê²½ë¡œ & ì„¤ì • ===

paths:
  root: {workspace_root}
  setup: setup/
  scripts: scripts/
  data: data/
  docs: docs/
  dev_docs: dev_docs/
  projects: projects/
  
files:
  main_guide: umis.yaml
  architecture: UMIS_ARCHITECTURE_BLUEPRINT.md
  install: INSTALL.md
  schema: schema_registry.yaml
  
execution:
  cd: {root}
  venv: source venv/bin/activate (optional)
  relative: from root

# === PART 4: ë©”ì‹œì§€ í…œí”Œë¦¿ ===

messages:
  í•œêµ­ì–´: ëª¨ë“  ì‘ë‹µ
  ì¹œí™”ì : ê¸°ìˆ ìš©ì–´ ì‰½ê²Œ
  ì´ëª¨ì§€: ìµœì†Œ (í•„ìš”ì‹œë§Œ)
  
  format:
    progress: "ğŸ” {action} ì¤‘..."
    success: "âœ… {result}"
    error: "âŒ {problem} â†’ {solution}"

# === PART 5: í´ë” êµ¬ì¡° (v7.0.0) ===

folders:
  setup: ì„¤ì¹˜ ê´€ë ¨ (AI_SETUP_GUIDE.md, setup.py)
  umis_rag: RAG ì½”ë“œ (ì‹¤ì œ ì‹œìŠ¤í…œ)
  scripts: RAG ìŠ¤í¬ë¦½íŠ¸
  data: Vector DB + íŒ¨í„´
  docs: í™œì„± í”„ë¡œí† ì½œ
  dev_docs: ê°œë°œ íˆìŠ¤í† ë¦¬ (ì‹œìŠ¤í…œ ë¹„ì˜ì¡´)
  projects: ë¶„ì„ í”„ë¡œì íŠ¸ (Git ì œì™¸)
  archive: Deprecated (main ë¸Œëœì¹˜ì—ì„œ ì œì™¸)

# === PART 6: Guardian Meta-RAG (v7.1.0) ===

guardian_meta_rag:
  enabled: true
  
  # í”„ë¡œì íŠ¸ ì‹œì‘ ì‹œ
  project_start:
    detect: ["í”„ë¡œì íŠ¸ ì‹œì‘", "[PROJECT_START]", "ìƒˆ í”„ë¡œì íŠ¸"]
    
    action: |
      from umis_rag.guardian import GuardianMetaRAG
      
      guardian = GuardianMetaRAG()
      goal_id = guardian.set_goal("{project_goal}")
      
      print("âœ… Guardian í™œì„±í™”: ëª©í‘œ ì„¤ì • ì™„ë£Œ")
      print("  - ìˆœí™˜ íŒ¨í„´ ê°ì§€")
      print("  - ëª©í‘œ ì •ë ¬ ëª¨ë‹ˆí„°ë§")
      print("  - í’ˆì§ˆ ìë™ í‰ê°€")
  
  # ì¿¼ë¦¬ ëª¨ë‹ˆí„°ë§
  circular_detection:
    check: "ë§¤ ì¿¼ë¦¬ë§ˆë‹¤"
    
    action: |
      result = guardian.memory.check_circular(query_text)
      
      if result['is_circular']:
          print("âš ï¸ ìˆœí™˜ ê°ì§€: ê°™ì€ ì£¼ì œ 3íšŒ ë°˜ë³µ")
          print(f"ğŸ’¡ ì œì•ˆ: {result['suggestion']}")
  
  # ì‚°ì¶œë¬¼ í‰ê°€
  deliverable_evaluation:
    detect: ["[DELIVERABLE_COMPLETE]", "ì‚°ì¶œë¬¼ ì™„ì„±"]
    
    action: |
      result = guardian.evaluate_deliverable({
          'id': deliverable_id,
          'content': content,
          'task_description': task
      })
      
      if result.passed:
          print(f"âœ… í’ˆì§ˆ ê²€ì¦ í†µê³¼: {result.grade}")
      else:
          for warning in result.warnings:
              print(f"âš ï¸ {warning}")
          for rec in result.recommendations:
              print(f"ğŸ’¡ {rec}")

# ========================================
# PART 7: System RAG (Key-based)
# ========================================

system_rag:
  enabled: true
  index_file: "umis_core.yaml"
  tool_registry: "config/tool_registry.yaml"
  total_tools: 25
  
  purpose: |
    AIê°€ 5ë¶„ ë‚´ UMIS ì „ì²´ íŒŒì•…
    ì»¨í…ìŠ¤íŠ¸ 77% ì ˆì•½ (5,508ì¤„ â†’ 450-2,850ì¤„)
  
  # AI ì‚¬ìš© ì „ëµ
  ai_strategy:
    step_1_always_load:
      file: "umis_core.yaml"
      size: "580ì¤„"
      content: "ì „ì²´ ì‹œìŠ¤í…œ ê°œìš”"
    
    step_2_parse_query:
      action: "ì‚¬ìš©ì ì¿¼ë¦¬ì—ì„œ agent + keywords ì¶”ì¶œ"
      
      examples:
        - query: "@Explorer, êµ¬ë… ëª¨ë¸ íŒ¨í„´"
          parse:
            agent: "explorer"
            keywords: ["êµ¬ë…", "ëª¨ë¸", "íŒ¨í„´"]
        
        - query: "ìŒì•… ìŠ¤íŠ¸ë¦¬ë° ì‹œì¥ ê·œëª¨"
          parse:
            agent: "quantifier"
            keywords: ["ì‹œì¥ ê·œëª¨", "SAM"]
    
    step_3_key_selection:
      rules:
        - if: "agent=explorer AND 'íŒ¨í„´' in keywords"
          key: "tool:explorer:pattern_search"
        
        - if: "agent=explorer AND 'ê¸°íšŒ' in keywords"
          key: "tool:explorer:7_step_process"
        
        - if: "agent=quantifier AND 'SAM' in keywords"
          key: "tool:quantifier:sam_4methods"
        
        - if: "agent=validator AND 'ì •ì˜' in keywords"
          key: "tool:validator:data_definition"
        
        - if: "agent=observer AND 'êµ¬ì¡°' in keywords"
          key: "tool:observer:market_structure"
        
        - if: "task='ì‹œì¥ ë¶„ì„'"
          keys:
            - "tool:observer:market_structure"
            - "tool:explorer:pattern_search"
            - "tool:quantifier:sam_4methods"
        
        - if: "task='Discovery Sprint'"
          keys:
            - "tool:framework:discovery_sprint"
            - "ëª¨ë“  Agent ë„êµ¬"
    
    step_4_search:
      for_each_key:
        command: "python scripts/query_system_rag.py {key}"
        result: "ë„êµ¬ content (200-800ì¤„)"
        latency: "0.1ms (KeyDirectory)"
    
    step_5_context:
      load:
        always: "umis_core.yaml (50ì¤„, í•µì‹¬ë§Œ)"
        searched: "System RAG ê²°ê³¼ (200-2,800ì¤„)"
      
      total_examples:
        simple: "450ì¤„ (vs 5,508ì¤„, 92% ì ˆì•½)"
        medium: "1,250ì¤„ (vs 5,508ì¤„, 77% ì ˆì•½)"
        complex: "2,850ì¤„ (vs 5,508ì¤„, 48% ì ˆì•½)"
      
      average_saving: "77%"
  
  shortcuts:
    - "ë„êµ¬ ëª©ë¡": "python scripts/query_system_rag.py --list"
    - "ë„êµ¬ ê²€ìƒ‰": "python scripts/query_system_rag.py tool:explorer:pattern_search"
    - "ì‹œìŠ¤í…œ ì¬êµ¬ì¶•": "python scripts/build_system_knowledge.py"

# ========================================
# END
# ========================================

