# ========================================
# UMIS Core (INDEX)
# System RAG용 압축된 핵심 가이드
# ========================================

# ⚡ TL;DR (AI: 바쁘면 여기만!)
#
# UMIS = 31개 도구를 RAG로 로드하는 시스템 (v7.6.2)
#
# 사용법:
#   1) 쿼리 분석 (agent + keywords)
#   2) Section 1 (Decision Guide)에서 tool_key 찾기
#   3) System RAG 검색 (python scripts/query_system_rag.py {tool_key})
#   4) 로드된 content 활용
#
# 도구: 31개 (E:4, Q:4, V:4, O:4, G:2, Est:3, F:10)
# 절약: 89% (6,787줄 → 450-2,850줄)
#
# AI 읽기 순서:
#   1. Quick Start (Line 40~) ← 사용법
#   2. Decision Guide (Line 85~) ← 도구 선택 (핵심!)
#   3. Agent Summary (Line 220~) ← 역할 (필요시)
#   4. System Details (Line 410~) ← 구조 (참고용)
#
#  v7.6.2 신규:
#   - 5-Phase 재설계 (Phase 0/1/2/3/4, 100% 커버리지)
#   - Validator 우선 검색 (Phase 2, 85% 처리)
#   - Web Search 추가 (DuckDuckGo + Google)
#   - 단위 자동 변환 & Relevance 검증
#   - Boundary 검증 (개념 기반)
#
# ========================================

_meta:
  version: "7.6.2"
  created: "2025-11-04"
  updated: "2025-11-10"
  type: "index"
  original_size: "6,787줄"
  compressed_size: "850줄"
  context_saving: "87%"

  purpose: |
    System RAG의 핵심 INDEX.
    AI가 필요한 도구만 정확히 로드할 수 있도록
    전체 시스템을 압축 요약.

  ai_reading_guide: |
    ⚠️ AI: 이 파일을 읽는 것만으로는 부족합니다!

    필수 실행 프로세스:
    1.  이 파일 읽기 (umis_core.yaml) - INDEX 파악
    2.  쿼리 분석 (agent + keywords)
    3.  System RAG 실행 (run_terminal_cmd 필수!)
    4.  로드된 도구로 작업

    핵심: System RAG 없이는 도구 content 없음!

# ========================================
# Section 0: QUICK START (AI 필수 실행!)
# ========================================

quick_start_for_ai:

  this_file_purpose:
    what: "UMIS 전체 시스템의 압축된 INDEX (도구 목록)"
    when: "모든 프로젝트 시작 시 첫 번째로 읽기"
    why: "컨텍스트 절약 + 필요한 도구만 로드"
    warning: "이 파일은 INDEX일 뿐! 실제 도구 content는 System RAG로 로드해야 함"

  mandatory_execution_process:

    step_0_prerequisite:
      check: "System RAG Collection 존재 확인"
      command: "python3 scripts/query_system_rag.py --stats"
      if_fails: "python3 scripts/build_system_knowledge.py (1분)"

    step_1_load_index:
      action: "read_file tool 사용"
      file: "umis_core.yaml"
      lines_to_read:
        - "40-87: Quick Start"
        - "88-110: Agent Selection"
        - "289-469: Decision Guide"
      output: "필요한 tool_key 리스트 식별"
      mandatory: true

    step_2_parse_query:
      action: "사용자 쿼리 분석"
      extract:
        - "agent_id (explorer, quantifier, ...)"
        - "task_type (패턴 검색, SAM 계산, ...)"
        - "keywords (구독, 시장 규모, ...)"
      refer_to: "Lines 96-109 (agent_selection_flowchart)"

    step_3_identify_tools:
      action: "Decision Guide 참조하여 tool_key 선택"
      refer_to: "Lines 289-469 (decision_guide)"
      output: "tool_key 리스트 (예: ['tool:explorer:pattern_search'])"

    step_4_execute_system_rag:
      action: " run_terminal_cmd tool 사용 (필수!)"
      command_template: "python3 scripts/query_system_rag.py {tool_key}"

      examples:
        single: "python3 scripts/query_system_rag.py tool:explorer:pattern_search"
        multiple: |
          python3 scripts/query_system_rag.py tool:observer:market_structure
          python3 scripts/query_system_rag.py tool:explorer:pattern_search
          python3 scripts/query_system_rag.py tool:quantifier:sam_4methods

      expected_output: "도구 content (200-800줄/개)"
      mandatory: true
      skip_penalty: "도구 없음 → 작업 실패"

    step_5_use_loaded_tools:
      action: "System RAG로 로드한 content 기반 작업"
      context_composition:
        - "umis_core.yaml (709줄, INDEX)"
        - "System RAG 결과 (200-2,500줄, 도구 content)"
        - "total: 900-3,200줄 (vs 6,102줄 전체)"
      savings: "47-85% 컨텍스트 절약"

  real_execution_examples:

    example_1_explorer_pattern:
      user_query: "@Explorer, 구독 모델 패턴"

      ai_actions:
        action_1_read_index:
          tool: "read_file"
          file: "umis_core.yaml"
          lines: "40-110"
          output: "Agent=explorer, task=pattern_search 파악"

        action_2_identify_tool:
          refer: "Line 347 (decision_guide.explorer.key_tools)"
          tool_key: "tool:explorer:pattern_search"

        action_3_system_rag:
          tool: "run_terminal_cmd"
          command: "python3 scripts/query_system_rag.py tool:explorer:pattern_search"
          expected: "~400줄 도구 content"
          mandatory: true

        action_4_execute:
          use: "로드된 도구 content"
          action: "RAG 패턴 검색 실행"

      context_total: "709 + 400 = 1,109줄 (vs 6,102줄, 82% 절약)"

    example_2_market_analysis:
      user_query: "음악 스트리밍 시장 분석"

      ai_actions:
        action_1_read_index:
          tool: "read_file"
          file: "umis_core.yaml"
          lines: "88-110"
          output: "시장 분석 = Observer → Explorer → Quantifier"

        action_2_identify_tools:
          refer: "Lines 296-469 (decision_guide)"
          tool_keys:
            - "tool:observer:market_structure"
            - "tool:explorer:pattern_search"
            - "tool:quantifier:sam_4methods"

        action_3_system_rag:
          tool: "run_terminal_cmd (3회 실행)"
          commands:
            - "python3 scripts/query_system_rag.py tool:observer:market_structure"
            - "python3 scripts/query_system_rag.py tool:explorer:pattern_search"
            - "python3 scripts/query_system_rag.py tool:quantifier:sam_4methods"
          expected: "~1,200줄 (3개 도구)"
          mandatory: true

        action_4_execute_workflow:
          step_1: "Observer: 시장 구조 관찰 (로드된 도구 활용)"
          step_2: "Explorer: 기회 발굴 (로드된 도구 + RAG)"
          step_3: "Quantifier: SAM 계산 (로드된 도구)"

      context_total: "709 + 1,200 = 1,909줄 (vs 6,102줄, 69% 절약)"

  critical_reminder:
    warning: |
      ⚠️ AI: System RAG 실행을 건너뛰지 마세요!

      ❌ 잘못된 접근:
        1. umis_core.yaml만 읽기
        2. 바로 작업 시작
        → 도구 content 없음 → 작업 실패

       올바른 접근:
        1. umis_core.yaml 읽기 (INDEX)
        2. tool_key 식별
        3. System RAG 실행 (run_terminal_cmd)
        4. 로드된 도구로 작업
        → 성공!

  shortcuts:
    - "도구 목록": "python3 scripts/query_system_rag.py --list"
    - "도구 검색": "python3 scripts/query_system_rag.py tool:explorer:pattern_search"
    - "통계 확인": "python3 scripts/query_system_rag.py --stats"
    - "인덱스 재구축": "python3 scripts/build_system_knowledge.py"

# ========================================
# Section 1: DECISION GUIDE (AI 핵심!)
# ========================================
# AI가 어떤 도구를 로드할지 결정하는 핵심 섹션
# AI: 모든 쿼리에서 여기를 먼저 읽으세요!
# ========================================

agent_selection_flowchart:
  # ⚡ 빠른 Agent 선택 (AI: 2초 판단!)

  "기회를 찾고 싶다": "Explorer (tool:explorer:pattern_search 우선)"
  "시장 규모를 알고 싶다": "Quantifier (tool:quantifier:sam_4methods)"
  "데이터를 검증하고 싶다": "Validator (tool:validator:data_definition)"
  "시장 구조를 파악하고 싶다": "Observer (tool:observer:market_structure)"
  "진행 상황을 관리하고 싶다": "Guardian (tool:guardian:progress_monitoring)"
  "값을 추정하고 싶다": "Estimator (tool:estimator:estimate)  v7.3.1+"

  복합_쿼리:
    "시장 분석": "Observer → Explorer → Quantifier (Estimator 협업)"
    "기회 검증": "Explorer → Validator → Quantifier (Estimator 협업)"
    "경쟁 분석": "Observer + Framework:competitive_analysis"
    "Discovery Sprint": "Framework:discovery_sprint + 모든 Agent (6개)"

  v7_3_2_policy:
    single_source: "모든 값/데이터 추정은 Estimator만 수행"
    other_agents: "다른 Agent는 Estimator 호출 필수"

system_details:
  name: "UMIS v7.7.0"
  tagline: "6-Agent + 5-Phase Estimator, Native 모드 구현"

  what_it_can_do:
    rag:
      - "360개 검증된 데이터 자동 검색"
      - "패턴 조합 발견 (Knowledge Graph)"
      - "6개 Agent RAG (모든 Agent)"

    agents:
      - "6-Agent 협업 시스템 (역할 MECE)"
      - "5-Phase Estimator (100% 커버리지)"
      - "Estimator/Quantifier 분리 (추정 vs 계산)"
      - "Native/External 모드 (LLM 선택)"
      - "완전한 추적성 (ID Namespace)"
      - "재검증 가능 (Excel 함수)"
      - "Single Source of Truth (Estimator)"

    automation:
      - "AI 자동 설치 (setup.py)"
      - "Excel 자동 생성 (3개 도구)"
      - "검증 자동화 (Guardian Meta-RAG)"
      - "학습 시스템 (6-16배 빠름)"
      - "재귀 추정 (Phase 4, v7.4.0+)" 
      - "LLM 모드 선택 (Native $0 / External)" 

  rag_architecture:
    version: "v3.0 (4-Layer)"

    layers:
      layer_1_canonical:
        - "Canonical Index (정규화)"
        - "Write 1곳만 (업데이트용)"
        - "재현성 보장"

      layer_2_projected:
        - "Projected Index (Agent별 검색용 뷰)"
        - "TTL 24h + On-Demand"
        - "90% 규칙 + 10% LLM 학습"

      layer_3_graph:
        - "Knowledge Graph (Neo4j)"
        - "13 노드, 45 관계"
        - "패턴 조합 발견"

      layer_4_memory:
        - "Query Memory (순환 감지)"
        - "Goal Memory (목표 정렬)"
        - "RAE Memory (평가 일관성)"

    active_collections:
      explorer:
        - "explorer_knowledge_base (354개)"
        - "projected_index (71개)"

      quantifier:
        - "calculation_methodologies (30개)"
        - "market_benchmarks (100개)"

      validator:
        - "data_sources_registry (50개)"
        - "definition_validation_cases (84개)"

      observer:
        - "market_structure_patterns (30개)"
        - "value_chain_benchmarks (50개)"

      estimator:
        - "learned_rules (0 → 2,000개 진화)"
        - "canonical_store (정규화)"
        - "estimator (Agent View)"

      system:
        - "system_knowledge (28개 도구)"

    how_it_works: |
      "@Explorer, 구독 모델"
      → System RAG: tool:explorer:pattern_search 로드
      → Vector RAG 검색
      → 패턴 발견 (subscription_model)
      → Graph 조합 (subscription + platform)
      → 사례 매칭 (Spotify, Netflix)
      → 결과 반환

workflows:
  comprehensive_study:
    duration: "2-4주"
    depth: "매우 상세"
    agents: "모든 Agent 순차 실행"
    deliverables: "15-20개 문서"

  rapid_assessment:
    duration: "1-3일"
    depth: "중간"
    agents: "핵심 Agent만"
    deliverables: "3-5개 문서"

  quick_insights:
    duration: "1-2시간"
    depth: "빠른 파악"
    agents: "1-2개 Agent"
    deliverables: "1-2개 요약"

  discovery_sprint:
    duration: "1-3일"
    condition: "명확도 < 7"
    agents: "6개 Agent 병렬 (Estimator 협업)"
    purpose: "목표 구체화"

key_concepts:
  id_namespace:
    why: "완전한 추적성"

    prefixes:
      OBS: "Observer 관찰 결과"
      OPP: "Explorer 기회 가설"
      SAM: "Quantifier 시장 규모"
      SRC: "Validator 데이터 소스"
      ASM: "가정 (Assumption)"
      EST: "추정치"

    example: "OPP_20251104_001 → 2025-11-04 첫 번째 기회"

  excel_functions:
    why: "재검증 가능성"

    approach: |
      모든 계산을 Excel 함수로
      → 누구나 검증 가능
      → 투명성 확보

    example: "=ASM_001*ASM_002 (가정 ID로 참조)"

  validation_protocol:
    principle: "모든 주장에 근거"

    levels:
      직접데이터: "SRC_xxx (출처)"
      추정치: "EST_xxx (추정 논리)"
      계산: "Excel 함수 (검증 가능)"

# ========================================
# Section 1.5: Universal Tools
# ========================================

universal_tools:

  guestimation:
    tool_key: "tool:universal:guestimation (Deprecated, use Estimator)"
    agent: "Estimator (v7.3.2+ Single Source)"
    category: "추정 방법론 → Estimator Agent로 통합"
    deprecated_note: "v7.3.2+: 직접 사용 금지, Estimator 호출 필수"

    when_to_use:
      - "❌ 더 이상 직접 사용하지 마세요"
      - " v7.3.2+: estimator.estimate() 호출"

    fermi_4_principles:
      - "모형 (시장 = 고객 × 구매액)"
      - "분해 (1인당 = 교통 + 식비 + 숙박)"
      - "제약 (하루 24h, 1끼 30분)"
      - "자릿수 (500억? 5000억?)"

    data_sources_8:
      sources:
        - "1. 프로젝트 데이터"
        - "2. LLM 직접 ('한국 인구?')"
        - "3. 검색 공통 맥락 (웹)"
        - "4. 법칙 (물리/법률)"
        - "5. 행동경제학 (Loss Aversion)"
        - "6. 통계 패턴 (80-20)"
        - "7. Rule of Thumb (RAG)"
        - "8. 시공간 제약 (24h)"
      rag_position: "출처 7의 일부 (12.5%)"

    benchmark_check: "4대 기준 (제품, 소비자, 가격, 맥락) → 3개 이상 유사"

    examples:
      - "피아노 15% (RAG 검증 후)"
      - "여행 2,500억 (상식+경험)"
      - "자장면 42만 (제약조건)"
      - "전봇대 716만 (Fermi)"

    migration:
      from: "tool:universal:guestimation (v7.2.1 이하)"
      to: "tool:estimator:estimate (v7.3.2+)"
      reason: "Single Source of Truth 정책"

    detail: "System RAG → tool:estimator:estimate (권장)"

# (Section 2-4는 다음 단계에서 추가)

# (이전 위치에서 이동됨)

decision_guide:

  observer:
    name: "Albert (기본)"
    role: "시장 구조 분석"
    rag: true
    rag_collections:
      - "market_structure_patterns (30개)"
      - "value_chain_benchmarks (50개)"

    what_it_does:
      - "가치사슬 맵핑"
      - "거래 패턴 관찰"
      - "비효율성 발견"
      - "경쟁 구조 분석"

    when_to_use:
      - "시장 구조 이해 필요"
      - "가치 흐름 분석"
      - "경쟁 구도 파악"
      - "비효율성 탐색"

    key_tools:
      - "tool:observer:market_structure (RAG)"
      - "tool:observer:value_chain (RAG)"
      - "tool:observer:inefficiency_detection"
      - "tool:observer:disruption_opportunity"

    deliverables:
      - "market_reality_report.md"

    output_to:
      - "Explorer (비효율성 → 기회)"
      - "Quantifier (구조 → 규모 추정)"

    detail_module: "modules/agents/observer.yaml (상세 800줄)"

  explorer:
    name: "Steve (기본)"
    role: "기회 발굴 (RAG 활용!)"
    rag: true
    rag_collections:
      - "explorer_knowledge_base (354개)"
      - "projected_index (71개)"

    what_it_does:
      - "RAG 패턴 자동 검색 (31+23개)"
      - "7단계 기회 발굴 프로세스"
      - "가설 생성 (LLM)"
      - "검증 프로토콜"

    when_to_use:
      - "기회 발굴"
      - "가설 생성"
      - "패턴 매칭"
      - "혁신 아이디어"

    key_tools:
      - "tool:explorer:pattern_search (RAG 우선!)"
      - "tool:explorer:7_step_process"
      - "tool:explorer:validation_protocol"
      - "tool:explorer:hypothesis_generation"

    deliverables:
      - "OPP_*.md (기회 가설)"
      - "opportunity_portfolio.md"

    output_to:
      - "Quantifier (기회 → 규모)"
      - "Validator (가설 → 검증)"

    detail_module: "modules/agents/explorer.yaml (상세 900줄)"

  quantifier:
    name: "Bill (기본)"
    role: "정량 분석 (RAG 활용!)"
    rag: true
    rag_collections:
      - "calculation_methodologies (30개)"
      - "market_benchmarks (100개)"

    what_it_does:
      - "SAM 4가지 방법 계산"
      - "성장률 분석"
      - "벤치마킹"
      - "Excel 자동 생성 (9개 시트)"

    when_to_use:
      - "시장 규모 추정"
      - "성장률 분석"
      - "벤치마크 비교"
      - "시나리오 계획"

    key_tools:
      - "tool:quantifier:sam_4methods (RAG)"
      - "tool:quantifier:growth_analysis"
      - "tool:quantifier:scenario_planning"
      - "tool:quantifier:benchmark_analysis"

    deliverables:
      - "market_sizing.xlsx (Excel 자동 생성)"
      - "growth_forecast.md"

    output_to:
      - "Validator (수치 → 검증)"
      - "Guardian (규모 → 평가)"

    detail_module: "modules/agents/quantifier.yaml (상세 700줄)"

  validator:
    name: "Rachel (기본)"
    role: "데이터 검증 (RAG 활용!)"
    rag: true
    rag_collections:
      - "data_sources_registry (50개)"
      - "definition_validation_cases (100개)"

    what_it_does:
      - "데이터 정의 검증"
      - "출처 확인"
      - "Gap 분석"
      - "창의적 소싱 (12가지 방법)"

    when_to_use:
      - "데이터 정의 불명확"
      - "출처 신뢰도 확인"
      - "산업별 정의 차이"
      - "데이터 부족"

    key_tools:
      - "tool:validator:data_definition (RAG)"
      - "tool:validator:creative_sourcing"
      - "tool:validator:gap_analysis"
      - "tool:validator:source_verification"

    deliverables:
      - "data_validation_report.md"
      - "source_registry.md"

    output_to:
      - "Quantifier (검증 완료 → 계산)"
      - "Guardian (품질 → 승인)"

    detail_module: "modules/agents/validator.yaml (상세 600줄)"

  guardian:
    name: "Stewart (기본)"
    role: "프로세스 모니터링 + 품질 평가"
    rag: true
    rag_collections:
      - "goal_memory (6개)"
      - "query_memory (17개)"
      - "rae_index (4개)"

    what_it_does:
      - "진행 모니터링 (순환 감지)"
      - "목표 정렬 확인"
      - "품질 평가 (3단계)"
      - "최종 승인"

    when_to_use:
      - "프로젝트 시작 (목표 설정)"
      - "산출물 완성 (품질 평가)"
      - "진행 중 (순환 감지)"

    key_tools:
      - "tool:guardian:progress_monitoring"
      - "tool:guardian:quality_evaluation"

    deliverables:
      - "quality_report.md"
      - "project_log.md"

    meta_rag:
      query_memory: "같은 주제 3회 반복 → 제안"
      goal_memory: "목표 이탈 감지 → 재정렬"
      rae_memory: "평가 일관성 유지"
      three_stage: "규칙 → 임계값 → LLM"

    detail_module: "modules/agents/guardian.yaml (상세 800줄)"

  estimator:
    name: "Fermi (기본)"
    role: "값 추정 및 판단 (v7.7.0 용어 명확화)"
    rag: true
    rag_collections:
      - "learned_rules (0 → 2,000개 진화)"
      - "canonical_store (정규화)"
      - "estimator (Agent View)"

    terminology_v7_7_0:
      files: "phase1_direct_rag.py, phase3_guestimation.py, phase4_fermi.py"
      classes: "Phase1DirectRAG, Phase3Guestimation, Phase4FermiDecomposition"
      phase: "전체 프로세스 단계 (Phase 0-4)"
      step: "Fermi 내부 세부 단계 (Step 1-4)"
      note: "Phase와 Step 분리로 혼란 해결"

    what_it_does:
      - "5-Phase Architecture (v7.7.0 용어 명확화)" 
      - "Validator 우선 검색 (Phase 2, 85% 처리)"
      - "순수 값 추정 전문 (계산은 Quantifier)" 
      - "개념 기반 Boundary 검증 (비정형 사고)"
      - "11개 Source 통합 (Web Search 포함)"
      - "학습 시스템 (사용할수록 빠름)"
      - "단위 자동 변환"
      - "Relevance 검증"

    when_to_use:
      - "데이터 부족 시 값 추정 (예: ARPU, Churn, 음식점 수)"
      - "Validator에 없는 값 추정"
      - "일반 Fermi 분해 (물리적/수학적)"
      - "복잡한 모형 (재귀 분해 필요)"

    what_not_to_use:
      - "❌ 비즈니스 지표 계산 (LTV, Payback 등) → Quantifier가 담당"
      - "❌ 확정 데이터 검색 → Validator가 우선"
      - "✅ 값 추정만 Estimator 사용"

    key_tools:
      - "tool:estimator:estimate (5-Phase 추정)"
      - "tool:estimator:contribute (사용자 기여)"
      - "tool:estimator:learning_stats (학습 통계)"

    deliverables:
      - "EstimationResult (value + reasoning_detail + boundary_check)"
      - "DecompositionTrace (Phase 4, depth + formula)"
      - "BoundaryCheck (개념 기반 검증)"

    five_phase_architecture_v7_6_2:
      phase_0:
        name: "Project Data"
        speed: "<0.1초"
        coverage: "10%"
        description: "프로젝트 확정 데이터 즉시 반환"
        confidence: "1.0"
      
      phase_1:
        name: "Direct RAG (Learned Rules)"
        speed: "<0.5초"
        coverage: "5% (초기), 40% (1년 후)"
        description: "학습 규칙만 (Built-in 제거)"
        confidence: "0.95+"
        change: "v7.6.0: Built-in Rules 완전 제거 (일관성 확보)"
      
      phase_2:
        name: "Validator 검색"
        speed: "<1초"
        coverage: "85% (현재), 50% (1년 후)"
        description: "확정 데이터 우선 검색 (강제)"
        confidence: "1.0"
        features:
          - "단위 자동 변환 (갑/년 → 갑/일)"
          - "Relevance 검증 (GDP 오류 방지)"
          - "data_sources_registry (24개)"
        change: "v7.6.0: 신규 추가 (핵심!)"
      
      phase_3:
        name: "Guestimation (11 Sources)"
        speed: "3-8초"
        coverage: "2-5%"
        description: "11개 Source 증거 기반 추정"
        confidence: "0.60-0.80"
        sources:
          - "Physical (3): 제약 조건"
          - "Soft (3): 가이드"
          - "Value (5): RAG, Web Search 등"
        change: "v7.6.2: Web Search 추가"
      
      phase_4:
        name: "Fermi Decomposition (Step 1-4)"
        speed: "10-30초"
        coverage: "3% (현재), 1% (1년 후)"
        description: "창조적 추정 (가장 가치있는 작업)"
        confidence: "0.60-0.80"
        features:
          - "하드코딩 제거 (v7.6.2)"
          - "재귀 추정 (depth 4)"
          - "Fallback 체계 (conf 0.5)"
        change: "v7.6.2: 정확도 3배 개선 (70% → 25% 오차)"
        
        internal_steps_v7_7_0:
          step_1:
            name: "초기 스캔"
            description: "가용 데이터 파악 (Bottom-up)"
            process:
              - "부모 데이터 상속 (재귀 시)"
              - "프로젝트 데이터 확인"
              - "RAG 검색 (벤치마크)"
          
          step_2:
            name: "모형 생성"
            description: "3-5개 후보 생성 (Top-down)"
            process:
              - "LLM 모형 생성"
              - "변수 재검색 (최대 2회)"
              - "변수 정책 필터링"
          
          step_3:
            name: "실행 가능성 체크"
            description: "재귀 추정으로 퍼즐 맞추기"
            process:
              - "Unknown 변수 재귀 호출"
              - "실행 가능성 점수 계산"
              - "최선 모형 선택"
          
          step_4:
            name: "모형 실행"
            description: "Backtracking으로 재조립"
            process:
              - "변수 바인딩 확인"
              - "수식 평가"
              - "Boundary 검증"
      
      phase_5:
        name: "Boundary 검증"
        speed: "<0.1초"
        description: "개념 기반 동적 타당성 검증"
        features:
          - "Hard Boundary (절대 한계, 거부)"
          - "Soft Boundary (참고 범위, 경고)"
          - "개념 타입 일반화 (count, rate, size)"
          - "상위 개념 동적 추론"
          - "논리적 상한/하한 자동 도출"
        change: "v7.6.2: 신규 추가"

    accuracy_v7_6_2:
      validator: "100% (0% 오차)"
      phase_4: "75% (25% 오차, 3배 개선)"
      e2e_success: "95% (19/20)"
      validator_coverage: "94.7%"

    detail_module: "umis_rag/agents/estimator/ (15개 파일, 5,500줄)"

# ========================================
# Section 2: AGENT SUMMARY
# ========================================
# AI: Agent를 모를 때만 읽으세요 (각 100줄)
# 대부분 쿼리는 Decision Guide만으로 충분!
# ========================================

agents:

  #  AI 사용 가이드:
  #   1. 쿼리에서 keywords 추출
  #   2. question_type_mapping에서 매칭
  #   3. 필요한 tool_key 식별
  #   4. System RAG로 검색

  question_type_mapping:

    market_analysis:
      keywords: ["시장 분석", "산업 분석", "경쟁 구조"]

      decision_logic:
        step_1_check_clarity:
          if_low_clarity:
            action: "Discovery Sprint"
            load_tools:
              - "tool:framework:discovery_sprint"
              - "tool:observer:market_structure"
              - "tool:explorer:pattern_search"
            agents: "모든 Agent 병렬"

          if_high_clarity:
            action: "Structured Analysis"
            load_tools:
              - "tool:observer:market_structure"
              - "tool:explorer:7_step_process"
            agents: "Albert → Steve 순차"

        step_2_determine_depth:
          quick: "tool:framework:13_dimensions만"
          standard: "Observer + Explorer"
          comprehensive: "모든 Agent 순차"

    opportunity_discovery:
      keywords: ["기회", "아이디어", "혁신", "새로운"]

      primary_agent: "explorer"

      required_tools:
        - "tool:explorer:pattern_search (RAG 우선!)"
        - "tool:explorer:7_step_process"

      optional_tools:
        - "tool:observer:market_structure (맥락)"
        - "tool:quantifier:sam_4methods (규모)"

      load_order:
        1: "tool:explorer:pattern_search (RAG)"
        2: "tool:explorer:7_step_process"
        3: "필요 시 observer, quantifier"

    market_sizing:
      keywords: ["시장 규모", "SAM", "TAM", "크기"]

      primary_agent: "quantifier"

      required_tools:
        - "tool:validator:data_definition (먼저!)"
        - "tool:quantifier:sam_4methods"

      workflow:
        1: "Validator가 데이터 정의 검증"
        2: "Quantifier가 4가지 방법 계산"
        3: "Convergence ±30% 확인"

      deliverable: "market_sizing.xlsx (Excel 자동 생성)"

    data_validation:
      keywords: ["검증", "확인", "출처", "정의"]

      primary_agent: "validator"

      required_tools:
        - "tool:validator:data_definition (RAG)"
        - "tool:validator:source_verification"

      optional_tools:
        - "tool:validator:gap_analysis (산업별 차이)"

    competitive_analysis:
      keywords: ["경쟁", "경쟁사", "점유율", "경쟁 우위"]

      required_tools:
        - "tool:framework:competitive_analysis"
        - "tool:framework:7_powers"
        - "tool:observer:market_structure"

      load_order:
        1: "Observer가 구조 파악"
        2: "Framework로 분석"

    disruption_strategy:
      keywords: ["파괴", "혁신", "1등 추월", "역전"]

      required_tools:
        - "tool:framework:counter_positioning"
        - "tool:observer:inefficiency_detection"
        - "tool:observer:disruption_opportunity"

      workflow:
        1: "비효율성 발견"
        2: "Counter-Positioning 전략"
        3: "실행 가능성 검증"

  ai_loading_strategy: |
    사용자 쿼리 분석
      ↓
    question_type_mapping에서 매칭
      ↓
    필요한 tool_key들 식별
      ↓
    System RAG로 정확 검색 (key 기반)
      ↓
    컨텍스트 구성 (필요한 것만)
      ↓
    실행

    컨텍스트 예상:
    - 단순 쿼리: umis_core.yaml (50줄) + 도구 1-2개 (400줄) = 450줄
    - 중간 쿼리: umis_core.yaml + 도구 3-5개 (1,200줄) = 1,250줄
    - 복잡 쿼리: umis_core.yaml + 도구 8-10개 (2,800줄) = 2,850줄

    vs 원본 (5,508줄):
    - 단순: 92% 절약
    - 중간: 77% 절약
    - 복잡: 48% 절약

    평균: 77% 절약 달성!

# ========================================
# Section 4: MODULE INDEX (상세 위치)
# ========================================
# AI: 도구의 원본 위치를 찾을 때만 읽으세요
# System RAG가 자동으로 로드하므로 직접 참조 불필요!
# ========================================

module_index:

  note: |
    umis_core.yaml은 INDEX.
    상세 내용은 System RAG로 로드.

  agents:
    observer:
      file: "modules/agents/observer.yaml"
      size: "800줄"
      tools: 4개
      note: "RAG로 로드: tool:observer:*"

    explorer:
      file: "modules/agents/explorer.yaml"
      size: "900줄"
      tools: 4개
      rag: true
      note: "RAG로 로드: tool:explorer:*"

    quantifier:
      file: "modules/agents/quantifier.yaml"
      size: "700줄"
      tools: 4개
      note: "RAG로 로드: tool:quantifier:*"

    validator:
      file: "modules/agents/validator.yaml"
      size: "600줄"
      tools: 4개
      note: "RAG로 로드: tool:validator:*"

    guardian:
      file: "modules/agents/guardian.yaml"
      size: "800줄"
      tools: 2개
      note: "RAG로 로드: tool:guardian:*"

    estimator:
      file: "umis_rag/agents/estimator/"
      size: "386줄"
      tools: 3개
      note: "RAG로 로드: tool:estimator:*  v7.3.1+"

  frameworks:
    market_definition:
      file: "modules/frameworks/market_definition.yaml"
      size: "1,000줄"
      tools: ["13_dimensions", "market_definition"]

    seven_powers:
      file: "modules/frameworks/seven_powers.yaml"
      size: "500줄"
      tool: "7_powers"

    discovery_sprint:
      file: "modules/frameworks/discovery_sprint.yaml"
      size: "400줄"
      tool: "discovery_sprint"

    counter_positioning:
      file: "modules/frameworks/counter_positioning.yaml"
      size: "300줄"
      tool: "counter_positioning"

  workflows:
    comprehensive:
      file: "modules/workflows/comprehensive.yaml"
      size: "600줄"

    rapid:
      file: "modules/workflows/rapid.yaml"
      size: "400줄"

    quick:
      file: "modules/workflows/quick.yaml"
      size: "200줄"

quick_reference:

  start_here:
    - "umis_core.yaml (이 파일) - 전체 개요"
    - "System RAG로 필요한 도구만 로드"
    - "상세 내용은 tool_key로 검색"

  common_commands:
    - "python scripts/query_system_rag.py --list (도구 목록)"
    - "python scripts/query_system_rag.py tool:explorer:pattern_search"
    - "python scripts/test_system_rag_determinism.py (결정성 테스트)"

  for_users:
    - "Cursor: '@Explorer, 구독 모델 패턴'"
    - "Cursor: '@Fermi, B2B SaaS Churn Rate는?'  v7.3.1+"
    - "AI가 자동으로 System RAG 활용"
    - "필요한 도구만 로드 → 빠르고 정확"

  v7_5_0_updates:
    - "Estimator 완성 (100% 커버리지)" 
    - "Estimator/Quantifier 역할 분리 (추정 vs 계산)" 
    - "임계값 강화 (Fermi 분해 집중)" 
    - "데이터 상속 (재귀 최적화)" 
    - "Context 전달 개선 (구체적 질문)" 
  
  v7_7_0_updates:
    - "Native 모드 진짜 구현 (비용 $0)"
    - "용어 체계 명확화 (Phase + Step)"
    - "3-Tier 개념 완전 Deprecated"
    - "Fermi 내부: Step 1-4 (명확성)"
    - "LLMProvider 클래스 추가"
    - "Explorer Native/External 분기"

# ========================================
# END
# ========================================


