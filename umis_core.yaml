# ========================================
# UMIS Core (INDEX) v7.8.0
# ========================================

version: 7.8.0
updated: 2025-11-24

purpose: |
  System RAG INDEX - AI가 어떤 도구를 로드할지 안내
  
  v7.8.0 (2025-11-24): ⭐⭐⭐ Major Release
    - Model Config 시스템: 중앙 집중식 LLM 관리 (17개 모델)
    - benchmarks/ 폴더: 통합 벤치마크 시스템
    - Phase 0-3 벤치마크: 98% 비용 절감 달성
    - Phase 4 평가 시스템: 내용/형식 분리 (110점)
    - phase4_fermi.py: Model Config 통합
    - env.template: Model Config 가이드 추가
  
  v7.7.1 (2025-11-21):
    - Estimator Phase 4 Few-shot 개선
    - 계산 연결성 145% 향상 (18/40 → 50/50)
    - Reasoning 필수화
  
structure:
  total_tools: 44
  tiers:
    tier_1_system: 9개 (umis.yaml 시스템 섹션)
    tier_2_complete: 6개 (Agent 전체 컨텍스트)
    tier_3_task: 29개 (세분화, 빠른 조회)

# ========================================
# AI 사용 가이드
# ========================================

ai_guide:
  
  step_1_choose_tier:
    question: 사용자가 무엇을 원하는가?
    
    answers:
      system_understanding:
        intent: UMIS 시스템 전체 이해
        tier: Tier 1 (System)
        tools:
          - tool:system:system_architecture
          - tool:system:implementation_guide
        context: ~6,400 tokens
      
      agent_work:
        intent: 특정 Agent 실제 작업 (권장!)
        tier: Tier 2 (Complete)
        tools:
          - tool:observer:complete
          - tool:explorer:complete
          - tool:quantifier:complete
        context: ~8,200 tokens (3개)
        note: umis.yaml 참조 불필요!
      
      quick_check:
        intent: 빠른 개념 확인
        tier: Tier 3 (Task)
        tools:
          - tool:observer:market_structure
          - tool:quantifier:sam_4methods
        context: ~800 tokens
        note: 실제 작업 시 Complete로 전환

  step_2_load_tools:
    command: python3 scripts/query_system_rag.py {tool_key}
    
    examples:
      - python3 scripts/query_system_rag.py tool:observer:complete
      - python3 scripts/query_system_rag.py tool:system:system_architecture

# ========================================
# 도구 목록
# ========================================

tools:
  
  tier_1_system:
    - tool:system:system_architecture (~1,774 tokens)
    - tool:system:system (~4,799 tokens)
    - tool:system:agents (~16,578 tokens, 매우 큼!)
    - tool:system:implementation_guide (~4,623 tokens)
    - tool:system:data_integrity_system (~4,154 tokens)
    - tool:system:adaptive_intelligence_system (~3,201 tokens)
    - tool:system:proactive_monitoring (~2,782 tokens)
    - tool:system:support_validation_system (~840 tokens)
    - tool:system:roles (~2,464 tokens)
  
  tier_2_complete:
    - tool:observer:complete (~1,676 tokens)
    - tool:explorer:complete (~3,559 tokens)
    - tool:quantifier:complete (~2,998 tokens)
    - tool:validator:complete (~2,430 tokens)
    - tool:guardian:complete (~1,954 tokens)
    - tool:estimator:complete (~3,584 tokens)
  
  tier_3_task:
    count: 29
    examples:
      - tool:observer:market_structure
      - tool:explorer:pattern_search
      - tool:quantifier:sam_4methods
      - tool:validator:data_definition
      - (25개 더)

# ========================================
# 사용 패턴
# ========================================

usage_patterns:
  
  pattern_general_work:
    description: 일반적인 Agent 작업
    tools:
      - tool:observer:complete
      - tool:explorer:complete
    context: ~5,235 tokens
    savings: 87%
    recommended: true
  
  pattern_market_analysis:
    description: 시장 분석 (3 Agent)
    tools:
      - tool:observer:complete
      - tool:explorer:complete
      - tool:quantifier:complete
    context: ~8,233 tokens
    savings: 80%
    recommended: true
  
  pattern_system_learning:
    description: 시스템 학습
    tools:
      - tool:system:system_architecture
      - tool:system:implementation_guide
    context: ~6,397 tokens
    savings: 84%
  
  pattern_quick_check:
    description: 빠른 조회
    tools:
      - tool:quantifier:sam_4methods
    context: ~461 tokens
    savings: 99%
    note: 실제 작업 시 Complete로

# ========================================
# 핵심 원칙
# ========================================

key_principles:
  
  for_ai:
    principle_1: 실제 작업 = Tier 2 (Complete) 사용!
    principle_2: Complete 사용 시 umis.yaml 참조 불필요
    principle_3: 필요한 도구만 로드 (75-96% 절약)
    principle_4: tool:system:agents는 너무 큼 (개별 Complete 권장)
  
  for_developers:
    principle_1: umis.yaml만 편집 (Source of Truth)
    principle_2: tool_registry.yaml 편집 금지 (자동 생성)
    principle_3: 수정 후 sync_umis_to_rag.py 실행
    principle_4: 백업 자동 생성 (안전)

# ========================================
# v7.8.0: Model Config System
# ========================================

model_config_system:
  version: 7.8.0
  purpose: 중앙 집중식 LLM 모델 관리
  
  key_features:
    - 17개 모델 중앙 관리 (config/model_configs.yaml)
    - .env 모델 변경 → 코드 수정 0줄
    - API 타입 자동 분기 (Responses/Chat)
    - Pro 모델 Fast Mode 자동 적용
    - Reasoning Effort 지능형 처리
  
  core_files:
    config: config/model_configs.yaml (320줄, 17개 모델)
    python: umis_rag/core/model_configs.py (262줄)
    router: umis_rag/core/model_router.py (확장)
  
  supported_models:
    o1_series: [o1-mini, o1, o1-2024-12-17, o1-pro, o1-pro-2025-03-19]
    o3_series: [o3, o3-2025-04-16, o3-mini, o3-mini-2025-01-31]
    gpt5_series: [gpt-5.1, gpt-5-pro]
    gpt4_series: [gpt-4.1-nano, gpt-4o-mini, gpt-4-turbo-preview, gpt-4o, gpt-4o-2024-08-06]
    total: 17개
  
  usage:
    change_model: .env에서 LLM_MODEL_PHASE4=gpt-5.1
    auto_apply:
      - API 타입 (responses/chat)
      - max_output_tokens (모델별 최적값)
      - reasoning_effort (지원 모델만)
      - temperature (지원 모델만)
      - Fast Mode (Pro 모델만)
  
  benefits:
    development: 모델 추가 5분 → 30초 (10배 ↓)
    maintenance: API 변경 시 코드 수정 불필요
    extensibility: YAML 5줄로 신규 모델 즉시 사용

# ========================================
# v7.8.0: LLM Optimization (3-Model 구성)
# ========================================

llm_optimization:
  version: 7.8.0
  achievement: 98% 비용 절감 달성!
  
  phase_0_2:
    model: gpt-4.1-nano
    coverage: 45%
    cost_per_task: $0.000033
    speed: 1.02초
    accuracy: 100%
    use_case:
      - Phase 0 (Literal)
      - Phase 1 (Inferred)
      - Phase 2 (Formula)
      - Quantifier 공식 계산
      - Validator 기본 검증
  
  phase_3:
    model: gpt-4o-mini
    coverage: 48%
    cost_per_task: $0.000121
    speed: 4.61초
    accuracy: 100%
    use_case:
      - Phase 3 Guestimation
      - Explorer RAG 검색
      - Validator 정의 검증
    note: 프롬프트 개선으로 100% 정확도
  
  phase_4:
    model: o1-mini
    coverage: 7%
    cost_per_task: $0.0033
    speed: 5-15초
    accuracy: 93%
    use_case:
      - Phase 4 Fermi Decomposition
      - Discovery Sprint
      - 복잡한 추론
  
  total_cost:
    per_1000_tasks: $0.30
    vs_previous: $15.00 (Sonnet Think)
    savings: 98%
    breakdown:
      phase_0_2: 450 × $0.000033 = $0.015
      phase_3: 480 × $0.000121 = $0.058
      phase_4: 70 × $0.0033 = $0.231
  
  env_configuration:
    USE_PHASE_BASED_ROUTING: true
    LLM_MODEL_PHASE0_2: gpt-4.1-nano
    LLM_MODEL_PHASE3: gpt-4o-mini
    LLM_MODEL_PHASE4: o1-mini
    note: Model Config 시스템이 자동으로 API 최적화

# ========================================
# v7.8.0: Benchmarks System
# ========================================

benchmarks_system:
  version: 7.8.0
  purpose: 통합 벤치마크 시스템
  
  structure:
    root: benchmarks/
    common: benchmarks/common/ (공통 모듈)
    estimator: benchmarks/estimator/ (Estimator 벤치마크)
    phase4: benchmarks/estimator/phase4/ (Phase 4 Fermi)
  
  phase4_contents:
    tests:
      - batch1.py (o1-mini, gpt-5.1 high, o3-mini)
      - batch2.py (gpt-5-pro, o1-pro)
      - batch3.py (gpt-4o, gpt-4o-mini, gpt-4-turbo)
      - batch4.py (gpt-5.1 medium)
      - batch5.py (gpt-5.1 low)
      - extended_10problems.py (확장 테스트)
    
    scenarios: 15개 Fermi 문제
    
    results: 8개 JSON 파일
    
    analysis:
      - model_recommendations.md (모델 추천)
      - evaluation_rebalancing.md (평가 재조정 v7.8.0)
    
    common: common.py (평가 시스템 v7.8.0)
  
  documentation:
    - MODEL_CONFIG_DESIGN.md (773줄)
    - MODEL_CONFIG_IMPLEMENTATION.md (203줄)
    - MODEL_CONFIG_TEST_RESULTS.md (275줄)
    - PHASE4_INTEGRATION_COMPLETE.md (350줄)
    - PHASE4_INTEGRATION_FINAL.md (420줄)
    - PHASE4_IMPROVEMENT_PLAN.md (1,035줄)
    - PHASE4_IMPROVEMENTS_SUMMARY.md (137줄)
  
  migration_plan:
    phase_1: Phase 4 이관 (완료)
    phase_2: Phase 0-3 추가 (예정)
    phase_3: 전체 Agent 확장 (예정)
    phase_4: Workflow 통합 (예정)

# ========================================
# v7.8.0: Phase 4 Evaluation System
# ========================================

phase4_evaluation:
  version: 7.8.0
  total_score: 110점
  
  scoring_breakdown:
    accuracy_score:
      points: "25점 (log10 기반 오차)"
    
    content_score:
      points: "45점"
      step_completeness: "10점 (분해 단계 완성도)"
      calculation_logic: "10점 (논리적 연결)"
      numerical_accuracy: "25점 (수치 정확도)"
    
    format_score:
      points: "5점"
      final_calculation: "2점 (0점 if 자동 생성)"
      calculation_verification: "2점 (0점 if 자동 생성)"
      concept_fields: "1점 (개념 필드 완성도)"
    
    decomposition_quality: "10점"
    conceptual_coherence: "15점"
    logic: "10점"
  
  key_improvement:
    issue: gpt-5.1은 핵심 추론 우수하지만 JSON 형식 약함
    solution: 내용(45점)/형식(5점) 분리 → 핵심 능력 정확 평가
    effect: gpt-5.1 평가 공정성 향상

# ========================================
# 끝
# ========================================
