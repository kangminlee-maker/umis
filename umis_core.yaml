# ========================================
# UMIS Core (INDEX)
# System RAG용 압축된 핵심 가이드
# ========================================
#
# 목적: AI가 5분 내 UMIS 전체 파악
# 크기: < 1,000줄 (원본 5,508줄의 18%)
# 컨텍스트 절약: 77% (4,508줄)
#
# ========================================

_meta:
  version: "7.1.0"
  created: "2025-11-04"
  type: "index"
  original_size: "5,508줄"
  compressed_size: "< 1,000줄"
  context_saving: "77%"
  
  purpose: |
    System RAG의 핵심 INDEX.
    AI가 필요한 도구만 정확히 로드할 수 있도록
    전체 시스템을 압축 요약.

# ========================================
# Section 1: System Overview (200줄)
# ========================================

system_identity:
  name: "UMIS v7.1.0"
  tagline: "RAG 기반 5-Agent 협업 시장 분석 시스템"
  
  what_it_can_do:
    rag:
      - "360개 검증된 데이터 자동 검색"
      - "패턴 조합 발견 (Knowledge Graph)"
      - "4개 Agent RAG (Quantifier, Validator, Observer, Guardian)"
    
    agents:
      - "5명 전문 Agent 협업"
      - "완전한 추적성 (ID Namespace)"
      - "재검증 가능 (Excel 함수)"
    
    automation:
      - "AI 자동 설치 (setup.py)"
      - "Excel 자동 생성 (9개 시트)"
      - "검증 자동화 (Guardian)"
  
  rag_architecture:
    version: "v3.0 (4-Layer)"
    
    layers:
      layer_1_canonical: 
        - "Canonical Index (정규화)"
        - "Write 1곳만 (업데이트용)"
        - "재현성 보장"
      
      layer_2_projected:
        - "Projected Index (Agent별 검색용 뷰)"
        - "TTL 24h + On-Demand"
        - "90% 규칙 + 10% LLM 학습"
      
      layer_3_graph:
        - "Knowledge Graph (Neo4j)"
        - "13 노드, 45 관계"
        - "패턴 조합 발견"
      
      layer_4_memory:
        - "Query Memory (순환 감지)"
        - "Goal Memory (목표 정렬)"
        - "RAE Memory (평가 일관성)"
    
    active_collections:
      explorer: 
        - "explorer_knowledge_base (354개)"
        - "projected_index (71개)"
      
      quantifier:
        - "calculation_methodologies (30개)"
        - "market_benchmarks (100개)"
      
      validator:
        - "data_sources_registry (50개)"
        - "definition_validation_cases (84개)"
      
      observer:
        - "market_structure_patterns (30개)"
        - "value_chain_benchmarks (50개)"
      
      system:
        - "system_knowledge (25개 도구)"
    
    how_it_works: |
      "@Explorer, 구독 모델"
      → System RAG: tool:explorer:pattern_search 로드
      → Vector RAG 검색
      → 패턴 발견 (subscription_model)
      → Graph 조합 (subscription + platform)
      → 사례 매칭 (Spotify, Netflix)
      → 결과 반환

workflows:
  comprehensive_study:
    duration: "2-4주"
    depth: "매우 상세"
    agents: "모든 Agent 순차 실행"
    deliverables: "15-20개 문서"
  
  rapid_assessment:
    duration: "1-3일"
    depth: "중간"
    agents: "핵심 Agent만"
    deliverables: "3-5개 문서"
  
  quick_insights:
    duration: "1-2시간"
    depth: "빠른 파악"
    agents: "1-2개 Agent"
    deliverables: "1-2개 요약"
  
  discovery_sprint:
    duration: "1-3일"
    condition: "명확도 < 7"
    agents: "5개 Agent 병렬"
    purpose: "목표 구체화"

key_concepts:
  id_namespace:
    why: "완전한 추적성"
    
    prefixes:
      OBS: "Observer 관찰 결과"
      OPP: "Explorer 기회 가설"
      SAM: "Quantifier 시장 규모"
      SRC: "Validator 데이터 소스"
      ASM: "가정 (Assumption)"
      EST: "추정치"
    
    example: "OPP_20251104_001 → 2025-11-04 첫 번째 기회"
  
  excel_functions:
    why: "재검증 가능성"
    
    approach: |
      모든 계산을 Excel 함수로
      → 누구나 검증 가능
      → 투명성 확보
    
    example: "=ASM_001*ASM_002 (가정 ID로 참조)"
  
  validation_protocol:
    principle: "모든 주장에 근거"
    
    levels:
      직접데이터: "SRC_xxx (출처)"
      추정치: "EST_xxx (추정 논리)"
      계산: "Excel 함수 (검증 가능)"

# (Section 2-4는 다음 단계에서 추가)

# ========================================
# Section 2: Agent Summary (500줄)
# - 각 Agent 100줄 요약
# ========================================

agents:
  
  observer:
    name: "Albert (기본)"
    role: "시장 구조 분석"
    rag: true
    rag_collections:
      - "market_structure_patterns (30개)"
      - "value_chain_benchmarks (50개)"
    
    what_it_does:
      - "가치사슬 맵핑"
      - "거래 패턴 관찰"
      - "비효율성 발견"
      - "경쟁 구조 분석"
    
    when_to_use:
      - "시장 구조 이해 필요"
      - "가치 흐름 분석"
      - "경쟁 구도 파악"
      - "비효율성 탐색"
    
    key_tools:
      - "tool:observer:market_structure (RAG)"
      - "tool:observer:value_chain (RAG)"
      - "tool:observer:inefficiency_detection"
      - "tool:observer:disruption_opportunity"
    
    deliverables:
      - "market_reality_report.md"
    
    output_to:
      - "Explorer (비효율성 → 기회)"
      - "Quantifier (구조 → 규모 추정)"
    
    detail_module: "modules/agents/observer.yaml (상세 800줄)"
  
  explorer:
    name: "Steve (기본)"
    role: "기회 발굴 (RAG 활용!)"
    rag: true
    rag_collections:
      - "explorer_knowledge_base (354개)"
      - "projected_index (71개)"
    
    what_it_does:
      - "RAG 패턴 자동 검색 (31+23개)"
      - "7단계 기회 발굴 프로세스"
      - "가설 생성 (LLM)"
      - "검증 프로토콜"
    
    when_to_use:
      - "기회 발굴"
      - "가설 생성"
      - "패턴 매칭"
      - "혁신 아이디어"
    
    key_tools:
      - "tool:explorer:pattern_search (RAG 우선!)"
      - "tool:explorer:7_step_process"
      - "tool:explorer:validation_protocol"
      - "tool:explorer:hypothesis_generation"
    
    deliverables:
      - "OPP_*.md (기회 가설)"
      - "opportunity_portfolio.md"
    
    output_to:
      - "Quantifier (기회 → 규모)"
      - "Validator (가설 → 검증)"
    
    detail_module: "modules/agents/explorer.yaml (상세 900줄)"
  
  quantifier:
    name: "Bill (기본)"
    role: "정량 분석 (RAG 활용!)"
    rag: true
    rag_collections:
      - "calculation_methodologies (30개)"
      - "market_benchmarks (100개)"
    
    what_it_does:
      - "SAM 4가지 방법 계산"
      - "성장률 분석"
      - "벤치마킹"
      - "Excel 자동 생성 (9개 시트)"
    
    when_to_use:
      - "시장 규모 추정"
      - "성장률 분석"
      - "벤치마크 비교"
      - "시나리오 계획"
    
    key_tools:
      - "tool:quantifier:sam_4methods (RAG)"
      - "tool:quantifier:growth_analysis"
      - "tool:quantifier:scenario_planning"
      - "tool:quantifier:benchmark_analysis"
    
    deliverables:
      - "market_sizing.xlsx (Excel 자동 생성)"
      - "growth_forecast.md"
    
    output_to:
      - "Validator (수치 → 검증)"
      - "Guardian (규모 → 평가)"
    
    detail_module: "modules/agents/quantifier.yaml (상세 700줄)"
  
  validator:
    name: "Rachel (기본)"
    role: "데이터 검증 (RAG 활용!)"
    rag: true
    rag_collections:
      - "data_sources_registry (50개)"
      - "definition_validation_cases (100개)"
    
    what_it_does:
      - "데이터 정의 검증"
      - "출처 확인"
      - "Gap 분석"
      - "창의적 소싱 (12가지 방법)"
    
    when_to_use:
      - "데이터 정의 불명확"
      - "출처 신뢰도 확인"
      - "산업별 정의 차이"
      - "데이터 부족"
    
    key_tools:
      - "tool:validator:data_definition (RAG)"
      - "tool:validator:creative_sourcing"
      - "tool:validator:gap_analysis"
      - "tool:validator:source_verification"
    
    deliverables:
      - "data_validation_report.md"
      - "source_registry.md"
    
    output_to:
      - "Quantifier (검증 완료 → 계산)"
      - "Guardian (품질 → 승인)"
    
    detail_module: "modules/agents/validator.yaml (상세 600줄)"
  
  guardian:
    name: "Stewart (기본)"
    role: "프로세스 모니터링 + 품질 평가"
    rag: true
    rag_collections:
      - "goal_memory (6개)"
      - "query_memory (17개)"
      - "rae_index (4개)"
    
    what_it_does:
      - "진행 모니터링 (순환 감지)"
      - "목표 정렬 확인"
      - "품질 평가 (3단계)"
      - "최종 승인"
    
    when_to_use:
      - "프로젝트 시작 (목표 설정)"
      - "산출물 완성 (품질 평가)"
      - "진행 중 (순환 감지)"
    
    key_tools:
      - "tool:guardian:progress_monitoring"
      - "tool:guardian:quality_evaluation"
    
    deliverables:
      - "quality_report.md"
      - "project_log.md"
    
    meta_rag:
      query_memory: "같은 주제 3회 반복 → 제안"
      goal_memory: "목표 이탈 감지 → 재정렬"
      rae_memory: "평가 일관성 유지"
      three_stage: "규칙 → 임계값 → LLM"
    
    detail_module: "modules/agents/guardian.yaml (상세 800줄)"

# TODO: Section 3-4 다음 단계에서 추가


# ========================================
# Section 3: Decision Guide (200줄)
# - AI가 최적 방법 판단
# ========================================

decision_guide:
  
  # AI가 사용자 쿼리를 분석하여 최적 도구 선택
  
  question_type_mapping:
    
    market_analysis:
      keywords: ["시장 분석", "산업 분석", "경쟁 구조"]
      
      decision_logic:
        step_1_check_clarity:
          if_low_clarity:
            action: "Discovery Sprint"
            load_tools:
              - "tool:framework:discovery_sprint"
              - "tool:observer:market_structure"
              - "tool:explorer:pattern_search"
            agents: "모든 Agent 병렬"
          
          if_high_clarity:
            action: "Structured Analysis"
            load_tools:
              - "tool:observer:market_structure"
              - "tool:explorer:7_step_process"
            agents: "Albert → Steve 순차"
        
        step_2_determine_depth:
          quick: "tool:framework:13_dimensions만"
          standard: "Observer + Explorer"
          comprehensive: "모든 Agent 순차"
    
    opportunity_discovery:
      keywords: ["기회", "아이디어", "혁신", "새로운"]
      
      primary_agent: "explorer"
      
      required_tools:
        - "tool:explorer:pattern_search (RAG 우선!)"
        - "tool:explorer:7_step_process"
      
      optional_tools:
        - "tool:observer:market_structure (맥락)"
        - "tool:quantifier:sam_4methods (규모)"
      
      load_order:
        1: "tool:explorer:pattern_search (RAG)"
        2: "tool:explorer:7_step_process"
        3: "필요 시 observer, quantifier"
    
    market_sizing:
      keywords: ["시장 규모", "SAM", "TAM", "크기"]
      
      primary_agent: "quantifier"
      
      required_tools:
        - "tool:validator:data_definition (먼저!)"
        - "tool:quantifier:sam_4methods"
      
      workflow:
        1: "Validator가 데이터 정의 검증"
        2: "Quantifier가 4가지 방법 계산"
        3: "Convergence ±30% 확인"
      
      deliverable: "market_sizing.xlsx (Excel 자동 생성)"
    
    data_validation:
      keywords: ["검증", "확인", "출처", "정의"]
      
      primary_agent: "validator"
      
      required_tools:
        - "tool:validator:data_definition (RAG)"
        - "tool:validator:source_verification"
      
      optional_tools:
        - "tool:validator:gap_analysis (산업별 차이)"
    
    competitive_analysis:
      keywords: ["경쟁", "경쟁사", "점유율", "경쟁 우위"]
      
      required_tools:
        - "tool:framework:competitive_analysis"
        - "tool:framework:7_powers"
        - "tool:observer:market_structure"
      
      load_order:
        1: "Observer가 구조 파악"
        2: "Framework로 분석"
    
    disruption_strategy:
      keywords: ["파괴", "혁신", "1등 추월", "역전"]
      
      required_tools:
        - "tool:framework:counter_positioning"
        - "tool:observer:inefficiency_detection"
        - "tool:observer:disruption_opportunity"
      
      workflow:
        1: "비효율성 발견"
        2: "Counter-Positioning 전략"
        3: "실행 가능성 검증"
  
  ai_loading_strategy: |
    사용자 쿼리 분석
      ↓
    question_type_mapping에서 매칭
      ↓
    필요한 tool_key들 식별
      ↓
    System RAG로 정확 검색 (key 기반)
      ↓
    컨텍스트 구성 (필요한 것만)
      ↓
    실행
    
    컨텍스트 예상:
    - 단순 쿼리: umis_core.yaml (50줄) + 도구 1-2개 (400줄) = 450줄
    - 중간 쿼리: umis_core.yaml + 도구 3-5개 (1,200줄) = 1,250줄
    - 복잡 쿼리: umis_core.yaml + 도구 8-10개 (2,800줄) = 2,850줄
    
    vs 원본 (5,508줄):
    - 단순: 92% 절약
    - 중간: 77% 절약
    - 복잡: 48% 절약
    
    평균: 77% 절약 달성!

# ========================================
# Section 4: Module Index (100줄)
# - 상세 모듈 위치
# ========================================

module_index:
  
  note: |
    umis_core.yaml은 INDEX.
    상세 내용은 System RAG로 로드.
  
  agents:
    observer:
      file: "modules/agents/observer.yaml"
      size: "800줄"
      tools: 4개
      note: "RAG로 로드: tool:observer:*"
    
    explorer:
      file: "modules/agents/explorer.yaml"
      size: "900줄"
      tools: 4개
      rag: true
      note: "RAG로 로드: tool:explorer:*"
    
    quantifier:
      file: "modules/agents/quantifier.yaml"
      size: "700줄"
      tools: 4개
      note: "RAG로 로드: tool:quantifier:*"
    
    validator:
      file: "modules/agents/validator.yaml"
      size: "600줄"
      tools: 4개
      note: "RAG로 로드: tool:validator:*"
    
    guardian:
      file: "modules/agents/guardian.yaml"
      size: "800줄"
      tools: 2개
      note: "RAG로 로드: tool:guardian:*"
  
  frameworks:
    market_definition:
      file: "modules/frameworks/market_definition.yaml"
      size: "1,000줄"
      tools: ["13_dimensions", "market_definition"]
    
    seven_powers:
      file: "modules/frameworks/seven_powers.yaml"
      size: "500줄"
      tool: "7_powers"
    
    discovery_sprint:
      file: "modules/frameworks/discovery_sprint.yaml"
      size: "400줄"
      tool: "discovery_sprint"
    
    counter_positioning:
      file: "modules/frameworks/counter_positioning.yaml"
      size: "300줄"
      tool: "counter_positioning"
  
  workflows:
    comprehensive:
      file: "modules/workflows/comprehensive.yaml"
      size: "600줄"
    
    rapid:
      file: "modules/workflows/rapid.yaml"
      size: "400줄"
    
    quick:
      file: "modules/workflows/quick.yaml"
      size: "200줄"

quick_reference:
  
  start_here:
    - "umis_core.yaml (이 파일) - 전체 개요"
    - "System RAG로 필요한 도구만 로드"
    - "상세 내용은 tool_key로 검색"
  
  common_commands:
    - "python scripts/query_system_rag.py --list (도구 목록)"
    - "python scripts/query_system_rag.py tool:explorer:pattern_search"
    - "python scripts/test_system_rag_determinism.py (결정성 테스트)"
  
  for_users:
    - "Cursor: '@Explorer, 구독 모델 패턴'"
    - "AI가 자동으로 System RAG 활용"
    - "필요한 도구만 로드 → 빠르고 정확"

# ========================================
# END
# ========================================


