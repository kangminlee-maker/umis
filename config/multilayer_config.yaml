# ========================================
# Multi-Layer Guestimation ê¸€ë¡œë²Œ ì„¤ì •
# v2.0 - 2025-11-05
# ========================================
#
# ì´ íŒŒì¼ í•˜ë‚˜ë¡œ UMIS ì „ì²´ì˜ LLM ë° ì›¹ ê²€ìƒ‰ ëª¨ë“œ ì œì–´
# ì½”ë“œ ìˆ˜ì • ì—†ì´ ì„¤ì •ë§Œ ë³€ê²½í•˜ë©´ ì „ì²´ ì‹œìŠ¤í…œì— ë°˜ì˜

version: "2.0"
updated: "2025-11-05"

# ========================================
# ê¸€ë¡œë²Œ ëª¨ë“œ ì„¤ì • (ì—¬ê¸°ë§Œ ìˆ˜ì •!)
# ========================================

global_modes:
  
  # LLM ì‚¬ìš© ëª¨ë“œ (Layer 2)
  llm_mode: "native"
  # ì˜µì…˜:
  #   "native"   - Cursor Agent LLM ì‚¬ìš© (ê¶Œì¥, ë¹„ìš© $0)
  #   "external" - OpenAI API í˜¸ì¶œ (ìë™í™”, ë¹„ìš© ë°œìƒ)
  #   "skip"     - Layer 2 ê±´ë„ˆë›°ê¸°
  
  # ì›¹ ê²€ìƒ‰ ëª¨ë“œ (Layer 3)
  web_search_mode: "native"
  # ì˜µì…˜:
  #   "native"   - ì‚¬ìš©ìê°€ ì§ì ‘ ê²€ìƒ‰ í›„ ì…ë ¥ (ê¶Œì¥, ë¹„ìš© $0)
  #   "api"      - SerpAPI í˜¸ì¶œ (ìë™í™”, ì›” 100íšŒ ë¬´ë£Œ)
  #   "scraping" - ì§ì ‘ ìŠ¤í¬ë˜í•‘ (ë¶ˆì•ˆì •, ì‚¬ìš© ë¹„ê¶Œì¥)
  #   "skip"     - Layer 3 ê±´ë„ˆë›°ê¸°
  
  # Interactive ëª¨ë“œ (ì‚¬ìš©ì ì…ë ¥ í™œì„±í™”)
  interactive_mode: false
  # true:  ì‚¬ìš©ì ì…ë ¥ ëŒ€ê¸° (Native ëª¨ë“œì—ì„œ)
  # false: ìë™ìœ¼ë¡œ ë‹¤ìŒ ë ˆì´ì–´ ì‹œë„

# ========================================
# Layer 2: LLM ì§ì ‘ ë‹µë³€ ì„¤ì •
# ========================================

layer_2_llm:
  
  # Native Mode ì„¤ì •
  native:
    enabled: true
    guidance_message: "ğŸ’¡ LLMì—ê²Œ ì§ì ‘ ì§ˆë¬¸í•˜ì„¸ìš”"
    cursor_integration: true
    
    # ê°„ë‹¨í•œ ì‚¬ì‹¤ ì§ˆë¬¸ íŒ¨í„´
    simple_fact_patterns:
      - ì¸êµ¬
      - í‰ê· .*ì‹œê°„
      - ì¼ë°˜ì 
      - ë³´í†µ
      - í†µìƒ
      - ëª‡
    
    # ì œì™¸ íŒ¨í„´ (ë³µì¡í•œ ì§ˆë¬¸)
    complex_patterns:
      - ì™œ
      - ì–´ë–»ê²Œ
      - ë¹„êµ
      - ë¶„ì„
  
  # External API ì„¤ì •
  external:
    enabled: false  # ê¸°ë³¸ ë¹„í™œì„± (ë¹„ìš© ë°œìƒ)
    model: "gpt-4o-mini"  # ì €ë ´í•œ ëª¨ë¸
    temperature: 0.1
    max_tokens: 50
    
    # API ë¹„ìš© (ì°¸ê³ )
    cost_per_1k_tokens: 0.00015  # $0.00015/1K tokens (GPT-4o-mini)
    estimated_cost_per_query: 0.001  # ~$0.001/ì§ˆë¬¸
    
    # Prompt í…œí”Œë¦¿
    prompt_template: |
      ì§ˆë¬¸: {question}
      
      ê°„ë‹¨í•œ ìˆ«ìë¡œë§Œ ë‹µë³€í•˜ì„¸ìš”.
      ì˜ˆ: "í•œêµ­ ì¸êµ¬ëŠ”?" â†’ "5200ë§Œëª…" ë˜ëŠ” "52,000,000"
      
      ì§ˆë¬¸ì´ ì¶”ì • ë¶ˆê°€ëŠ¥í•˜ë©´ "ì•Œ ìˆ˜ ì—†ìŒ"ì´ë¼ê³  ë‹µë³€í•˜ì„¸ìš”.
  
  # ì‹ ë¢°ë„
  confidence: 0.7  # LLM ë‹µë³€ì€ ê²€ì¦ ê¶Œì¥
  
  # ìˆ«ì ì¶”ì¶œ íŒ¨í„´ (ì •ê·œì‹ì€ ì½”ë“œì—ì„œ ì²˜ë¦¬)
  number_extraction:
    enabled: true
    # íŒ¨í„´ì€ ì½”ë“œ ë‚´ì¥ (YAML ì •ê·œì‹ ì´ìŠˆ íšŒí”¼)

# ========================================
# Layer 3: ì›¹ ê²€ìƒ‰ ì„¤ì •
# ========================================

layer_3_web_search:
  
  # Native Mode ì„¤ì •
  native:
    enabled: true
    guidance_message: "ğŸ” ì›¹ ê²€ìƒ‰ í›„ ê²°ê³¼ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
    
    # ê²€ìƒ‰ ê¶Œì¥ ì—”ì§„
    recommended_engines:
      - "Google"
      - "Naver"
      - "Wikipedia"
    
    # ê²°ê³¼ ìˆ˜ ê¶Œì¥
    recommended_count: 5
  
  # API Mode ì„¤ì • (SerpAPI)
  api:
    enabled: false  # ê¸°ë³¸ ë¹„í™œì„±
    provider: "serpapi"  # ë˜ëŠ” "google_custom_search"
    
    # SerpAPI ì„¤ì •
    serpapi:
      api_key_env: "SERPAPI_KEY"  # í™˜ê²½ë³€ìˆ˜ ì´ë¦„
      endpoint: "https://serpapi.com/search"
      results_count: 20  # ìƒìœ„ 20ê°œ (ì‚¬ìš©ì ìš”ì²­)
      
      # ì›” ë¬´ë£Œ í•œë„
      free_quota: 100  # 100íšŒ/ì›”
      cost_per_query: 0.01  # ì´ˆê³¼ ì‹œ $0.01/ê²€ìƒ‰
    
    # Google Custom Search ì„¤ì •
    google_custom:
      api_key_env: "GOOGLE_SEARCH_API_KEY"
      search_engine_id_env: "GOOGLE_SEARCH_ENGINE_ID"
      results_count: 20
      
      # ì¼ ë¬´ë£Œ í•œë„
      free_quota: 100  # 100íšŒ/ì¼
  
  # Scraping Mode ì„¤ì • (ì‚¬ìš© ë¹„ê¶Œì¥)
  scraping:
    enabled: false
    warning: "ë¶ˆì•ˆì •í•˜ê³  robots.txt ìœ„ë°˜ ê°€ëŠ¥ì„±"
    user_agent: "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)"
    timeout: 5  # ì´ˆ
  
  # ê³µí†µê°’ ì¶”ì¶œ ì„¤ì • (ì‚¬ìš©ì ìš”ì²­ ë°˜ì˜)
  consensus_extraction:
    
    # ë°©ë²• 1: í´ëŸ¬ìŠ¤í„°ë§
    clustering:
      enabled: true
      tolerance: 0.2  # Â±20% ë²”ìœ„
      min_cluster_size: 3  # ìµœì†Œ 3ê°œ ì´ìƒ
    
    # ë°©ë²• 2: ì´ìƒì¹˜ ì œê±°
    outlier_removal:
      enabled: true
      method: "iqr"  # 'iqr', 'zscore', 'mad'
      threshold: 1.5  # IQR * 1.5
    
    # ë°©ë²• 3: ìœ ì‚¬ë„ ê¸°ë°˜ (ì‚¬ìš©ì ìš”ì²­)
    similarity_based:
      enabled: true
      threshold: 0.7  # ìœ ì‚¬ë„ 0.7 ì´ìƒë§Œ (ì‚¬ìš©ì ìš”ì²­)
      method: "text_similarity"  # ë˜ëŠ” 'value_similarity'
    
    # ìµœì¢… ê°’ ì„ íƒ
    final_value:
      method: "median"  # 'median', 'mean', 'mode'
      fallback: "mean"  # median ê³„ì‚° ë¶ˆê°€ ì‹œ
  
  # ì‹ ë¢°ë„
  confidence:
    api_search: 0.8         # API ê²€ìƒ‰ ê²°ê³¼
    manual_input: 0.75      # ì‚¬ìš©ì ì…ë ¥
    featured_snippet: 0.85  # Google Featured Snippet
    consensus_low: 0.6      # 3-5ê°œ ê²°ê³¼
    consensus_high: 0.8     # 6ê°œ ì´ìƒ ê²°ê³¼

# ========================================
# Layer í™œì„±í™” ì„¤ì •
# ========================================

layer_activation:
  layer_1_project_data: true      # í•­ìƒ í™œì„±
  layer_2_llm: true               # llm_modeì— ë”°ë¼
  layer_3_web_search: true        # web_search_modeì— ë”°ë¼
  layer_4_law: true               # í•­ìƒ í™œì„±
  layer_5_behavioral: true        # í•­ìƒ í™œì„±
  layer_6_statistical: true       # í•­ìƒ í™œì„±
  layer_7_rag: true               # í•­ìƒ í™œì„±
  layer_8_constraint: true        # í•­ìƒ í™œì„±

# ========================================
# ì‹ ë¢°ë„ ì„ê³„ê°’ (Confidence Thresholds)
# ========================================

confidence_thresholds:
  # ê° ë ˆì´ì–´ë³„ ìµœì†Œ ì‹ ë¢°ë„ (ì´ ì´ìƒì´ì–´ì•¼ ì±„íƒ)
  layer_2_llm: 0.7
  layer_3_web: 0.75
  layer_5_behavioral: 0.6
  layer_6_statistical: 0.5
  layer_7_rag: 0.5
  layer_8_constraint: 0.4

# ========================================
# ë””ë²„ê¹… ë° ë¡œê¹…
# ========================================

debug:
  verbose: true              # ìƒì„¸ ë¡œê·¸ ì¶œë ¥
  trace_all_layers: true     # ëª¨ë“  ë ˆì´ì–´ ì‹œë„ ê¸°ë¡
  show_rejected: true        # ê¸°ê°ëœ ë°ì´í„° í‘œì‹œ
  
  # ë ˆì´ì–´ë³„ ë¡œê·¸ ë ˆë²¨
  layer_logging:
    layer_1: "INFO"
    layer_2: "INFO"
    layer_3: "INFO"
    layer_4: "DEBUG"
    layer_5: "DEBUG"
    layer_6: "DEBUG"
    layer_7: "INFO"
    layer_8: "DEBUG"

# ========================================
# ì‚¬ìš© ì˜ˆì‹œ (ì£¼ì„)
# ========================================

usage_examples:
  
  example_1_native_mode:
    description: "ê¸°ë³¸ ì„¤ì • (Native Mode, ë¹„ìš© $0)"
    settings:
      llm_mode: "native"
      web_search_mode: "native"
      interactive_mode: false
    
    behavior: |
      Layer 2: ì‚¬ìš©ìì—ê²Œ LLM ì§ˆë¬¸ ì•ˆë‚´ (ìë™ ì‹¤í–‰ ì•ˆ í•¨)
      Layer 3: ì‚¬ìš©ìì—ê²Œ ì›¹ ê²€ìƒ‰ ì•ˆë‚´ (ìë™ ì‹¤í–‰ ì•ˆ í•¨)
      â†’ ë‹¤ë¥¸ ë ˆì´ì–´ë¡œ ìë™ ë„˜ì–´ê°
  
  example_2_external_automation:
    description: "ì™„ì „ ìë™í™” (ë¹„ìš© ë°œìƒ)"
    settings:
      llm_mode: "external"
      web_search_mode: "api"
      interactive_mode: false
    
    behavior: |
      Layer 2: OpenAI API ìë™ í˜¸ì¶œ
      Layer 3: SerpAPI ìë™ í˜¸ì¶œ
      â†’ ì‚¬ìš©ì ê°œì… ì—†ì´ ìë™ ì¶”ì •
  
  example_3_interactive:
    description: "ì‚¬ìš©ì ì…ë ¥ ëª¨ë“œ"
    settings:
      llm_mode: "native"
      web_search_mode: "native"
      interactive_mode: true
    
    behavior: |
      Layer 2: "LLM ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”:" í”„ë¡¬í”„íŠ¸
      Layer 3: "ì›¹ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì…ë ¥í•˜ì„¸ìš”:" í”„ë¡¬í”„íŠ¸
      â†’ ì‚¬ìš©ìê°€ ê°’ ì…ë ¥ ì‹œ ì¦‰ì‹œ ë°˜í™˜

# ========================================
# ì£¼ì˜ì‚¬í•­
# ========================================

warnings:
  llm_external:
    message: "OpenAI API ë¹„ìš© ë°œìƒ (~$0.001/ì§ˆë¬¸)"
    requires: "OPENAI_API_KEY í™˜ê²½ë³€ìˆ˜"
  
  web_api:
    message: "SerpAPI ë¹„ìš© (ì›” 100íšŒ ë¬´ë£Œ, ì´ˆê³¼ ì‹œ $0.01/ê²€ìƒ‰)"
    requires: "SERPAPI_KEY í™˜ê²½ë³€ìˆ˜"
  
  web_scraping:
    message: "ë¶ˆì•ˆì •í•˜ë©° robots.txt ìœ„ë°˜ ê°€ëŠ¥ì„±"
    recommendation: "ì‚¬ìš© ë¹„ê¶Œì¥"

# ========================================
# API í‚¤ í™˜ê²½ë³€ìˆ˜
# ========================================

required_env_vars:
  layer_2_external:
    - OPENAI_API_KEY  # LLM APIìš©
  
  layer_3_api:
    - SERPAPI_KEY     # SerpAPIìš©
    # ë˜ëŠ”
    - GOOGLE_SEARCH_API_KEY
    - GOOGLE_SEARCH_ENGINE_ID

# ========================================
# ê³ ê¸‰ ì„¤ì •
# ========================================

advanced:
  
  # Layer 2: LLM ì‘ë‹µ ê²€ì¦
  llm_validation:
    enabled: true
    max_retries: 2  # ìˆ«ì ì¶”ì¶œ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„
    sanity_check: true  # ë²”ìœ„ ì²´í¬ (0 < value < 1e12)
  
  # Layer 3: ì›¹ ê²€ìƒ‰ í•„í„°ë§
  web_filtering:
    # ì‹ ë¢° ê°€ëŠ¥í•œ ë„ë©”ì¸ ìš°ì„ 
    trusted_domains:
      - "wikipedia.org"
      - "statista.com"
      - "kosis.kr"  # í†µê³„ì²­
      - "kostat.go.kr"  # í†µê³„ì²­
      - "index.go.kr"  # ì •ë¶€ ì§€í‘œ
    
    # ì œì™¸ ë„ë©”ì¸
    exclude_domains:
      - "example.com"
    
    # ë‚ ì§œ í•„í„° (ìµœì‹ ì„±)
    date_filter:
      enabled: true
      max_age_days: 365  # 1ë…„ ì´ë‚´ ë°ì´í„°ë§Œ
  
  # ìºì‹± (ë™ì¼ ì§ˆë¬¸ ì¬ì‚¬ìš©)
  caching:
    enabled: true
    ttl: 86400  # 24ì‹œê°„
    cache_file: "data/cache/multilayer_cache.json"

# ========================================
# ëª¨ë‹ˆí„°ë§
# ========================================

monitoring:
  # API í˜¸ì¶œ íšŸìˆ˜ ì¶”ì 
  track_api_calls: true
  
  # ë¹„ìš© ì¶”ì 
  track_costs: true
  cost_alert_threshold: 10.0  # $10 ì´ˆê³¼ ì‹œ ê²½ê³ 
  
  # ë¡œê·¸ ì €ì¥
  save_logs: true
  log_path: "logs/multilayer_guestimation.log"

# ========================================
# END
# ========================================

