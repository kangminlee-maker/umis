// UMIS Schema Registry - Protocol Buffers 정의
// v7.5.0 - Production Format Optimization
//
// 사용법:
//   1. 컴파일: protoc --python_out=. schema_registry.proto
//   2. 생성: schema_registry_pb2.py
//   3. 사용: from schema_registry_pb2 import SchemaRegistry

syntax = "proto3";

package umis.schema;

// 스키마 레지스트리 (최상위)
message SchemaRegistry {
  map<string, Schema> schemas = 1;  // schema_id → Schema
  string version = 2;
  int64 updated_at = 3;  // Unix timestamp
}

// 개별 스키마 정의
message Schema {
  string schema_id = 1;
  string name = 2;
  string description = 3;
  SchemaType type = 4;
  repeated Field fields = 5;
  map<string, string> metadata = 6;
}

// 스키마 타입
enum SchemaType {
  UNKNOWN = 0;
  DELIVERABLE = 1;
  METHODOLOGY = 2;
  DATA_SOURCE = 3;
  METRIC = 4;
}

// 필드 정의
message Field {
  string name = 1;
  FieldType type = 2;
  bool required = 3;
  string description = 4;
  oneof default_value {
    string string_default = 5;
    int64 int_default = 6;
    double float_default = 7;
    bool bool_default = 8;
  }
  repeated string allowed_values = 9;  // enum-like
  Validation validation = 10;
}

// 필드 타입
enum FieldType {
  STRING = 0;
  INTEGER = 1;
  FLOAT = 2;
  BOOLEAN = 3;
  ARRAY = 4;
  OBJECT = 5;
  DATE = 6;
  ENUM = 7;
}

// 유효성 검사 규칙
message Validation {
  oneof rule {
    IntRange int_range = 1;
    FloatRange float_range = 2;
    StringLength string_length = 3;
    Regex regex = 4;
  }
}

message IntRange {
  int64 min = 1;
  int64 max = 2;
}

message FloatRange {
  double min = 1;
  double max = 2;
}

message StringLength {
  int32 min = 1;
  int32 max = 2;
}

message Regex {
  string pattern = 1;
}

